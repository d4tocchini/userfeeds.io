!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s="./src/about/about.js")}({"./node_modules/scrollreveal/dist/scrollreveal.js":function(e,t,n){var i;!function(){"use strict";function o(e){return void 0===this||Object.getPrototypeOf(this)!==o.prototype?new o(e):(S=this,S.version="3.3.6",S.tools=new L,S.isSupported()?(S.tools.extend(S.defaults,e||{}),S.defaults.container=r(S.defaults),S.store={elements:{},containers:[]},S.sequences={},S.history=[],S.uid=0,S.initialized=!1):"undefined"!=typeof console&&null!==console&&console.log("ScrollReveal is not supported in this browser."),S)}function r(e){if(e&&e.container){if("string"==typeof e.container)return window.document.documentElement.querySelector(e.container);if(S.tools.isNode(e.container))return e.container;console.log('ScrollReveal: invalid container "'+e.container+'" provided.'),console.log("ScrollReveal: falling back to default container.")}return S.defaults.container}function s(e,t){return"string"==typeof e?Array.prototype.slice.call(t.querySelectorAll(e)):S.tools.isNode(e)?[e]:S.tools.isNodeList(e)?Array.prototype.slice.call(e):[]}function a(){return++S.uid}function l(e,t,n){t.container&&(t.container=n),e.config?e.config=S.tools.extendClone(e.config,t):e.config=S.tools.extendClone(S.defaults,t),"top"===e.config.origin||"bottom"===e.config.origin?e.config.axis="Y":e.config.axis="X"}function c(e){var t=window.getComputedStyle(e.domEl);e.styles||(e.styles={transition:{},transform:{},computed:{}},e.styles.inline=e.domEl.getAttribute("style")||"",e.styles.inline+="; visibility: visible; ",e.styles.computed.opacity=t.opacity,t.transition&&"all 0s ease 0s"!==t.transition?e.styles.computed.transition=t.transition+", ":e.styles.computed.transition=""),e.styles.transition.instant=d(e,0),e.styles.transition.delayed=d(e,e.config.delay),e.styles.transform.initial=" -webkit-transform:",e.styles.transform.target=" -webkit-transform:",u(e),e.styles.transform.initial+="transform:",e.styles.transform.target+="transform:",u(e)}function d(e,t){var n=e.config;return"-webkit-transition: "+e.styles.computed.transition+"-webkit-transform "+n.duration/1e3+"s "+n.easing+" "+t/1e3+"s, opacity "+n.duration/1e3+"s "+n.easing+" "+t/1e3+"s; transition: "+e.styles.computed.transition+"transform "+n.duration/1e3+"s "+n.easing+" "+t/1e3+"s, opacity "+n.duration/1e3+"s "+n.easing+" "+t/1e3+"s; "}function u(e){var t,n=e.config,i=e.styles.transform;t="top"===n.origin||"left"===n.origin?/^-/.test(n.distance)?n.distance.substr(1):"-"+n.distance:n.distance,parseInt(n.distance)&&(i.initial+=" translate"+n.axis+"("+t+")",i.target+=" translate"+n.axis+"(0)"),n.scale&&(i.initial+=" scale("+n.scale+")",i.target+=" scale(1)"),n.rotate.x&&(i.initial+=" rotateX("+n.rotate.x+"deg)",i.target+=" rotateX(0)"),n.rotate.y&&(i.initial+=" rotateY("+n.rotate.y+"deg)",i.target+=" rotateY(0)"),n.rotate.z&&(i.initial+=" rotateZ("+n.rotate.z+"deg)",i.target+=" rotateZ(0)"),i.initial+="; opacity: "+n.opacity+";",i.target+="; opacity: "+e.styles.computed.opacity+";"}function f(e){var t=e.config.container;t&&-1===S.store.containers.indexOf(t)&&S.store.containers.push(e.config.container),S.store.elements[e.id]=e}function m(e,t,n){var i={target:e,config:t,interval:n};S.history.push(i)}function p(){if(S.isSupported()){v();for(var e=0;e<S.store.containers.length;e++)S.store.containers[e].addEventListener("scroll",g),S.store.containers[e].addEventListener("resize",g);S.initialized||(window.addEventListener("scroll",g),window.addEventListener("resize",g),S.initialized=!0)}return S}function g(){k(v)}function y(){var e,t,n,i;S.tools.forOwn(S.sequences,function(o){i=S.sequences[o],e=!1;for(var r=0;r<i.elemIds.length;r++)n=i.elemIds[r],t=S.store.elements[n],T(t)&&!e&&(e=!0);i.active=e})}function v(){var e,t;y(),S.tools.forOwn(S.store.elements,function(n){t=S.store.elements[n],e=x(t),h(t)?(t.config.beforeReveal(t.domEl),e?t.domEl.setAttribute("style",t.styles.inline+t.styles.transform.target+t.styles.transition.delayed):t.domEl.setAttribute("style",t.styles.inline+t.styles.transform.target+t.styles.transition.instant),w("reveal",t,e),t.revealing=!0,t.seen=!0,t.sequence&&b(t,e)):O(t)&&(t.config.beforeReset(t.domEl),t.domEl.setAttribute("style",t.styles.inline+t.styles.transform.initial+t.styles.transition.instant),w("reset",t),t.revealing=!1)})}function b(e,t){var n=0,i=0,o=S.sequences[e.sequence.id];o.blocked=!0,t&&"onload"===e.config.useDelay&&(i=e.config.delay),e.sequence.timer&&(n=Math.abs(e.sequence.timer.started-new Date),window.clearTimeout(e.sequence.timer)),e.sequence.timer={started:new Date},e.sequence.timer.clock=window.setTimeout(function(){o.blocked=!1,e.sequence.timer=null,g()},Math.abs(o.interval)+i-n)}function w(e,t,n){var i=0,o=0,r="after";switch(e){case"reveal":o=t.config.duration,n&&(o+=t.config.delay),r+="Reveal";break;case"reset":o=t.config.duration,r+="Reset"}t.timer&&(i=Math.abs(t.timer.started-new Date),window.clearTimeout(t.timer.clock)),t.timer={started:new Date},t.timer.clock=window.setTimeout(function(){t.config[r](t.domEl),t.timer=null},o-i)}function h(e){if(e.sequence){var t=S.sequences[e.sequence.id];return t.active&&!t.blocked&&!e.revealing&&!e.disabled}return T(e)&&!e.revealing&&!e.disabled}function x(e){var t=e.config.useDelay;return"always"===t||"onload"===t&&!S.initialized||"once"===t&&!e.seen}function O(e){if(e.sequence){return!S.sequences[e.sequence.id].active&&e.config.reset&&e.revealing&&!e.disabled}return!T(e)&&e.config.reset&&e.revealing&&!e.disabled}function E(e){return{width:e.clientWidth,height:e.clientHeight}}function j(e){if(e&&e!==window.document.documentElement){var t=q(e);return{x:e.scrollLeft+t.left,y:e.scrollTop+t.top}}return{x:window.pageXOffset,y:window.pageYOffset}}function q(e){var t=0,n=0,i=e.offsetHeight,o=e.offsetWidth;do{isNaN(e.offsetTop)||(t+=e.offsetTop),isNaN(e.offsetLeft)||(n+=e.offsetLeft),e=e.offsetParent}while(e);return{top:t,left:n,height:i,width:o}}function T(e){var t=q(e.domEl),n=E(e.config.container),i=j(e.config.container),o=e.config.viewFactor,r=t.height,s=t.width,a=t.top,l=t.left,c=a+r,d=l+s;return function(){var t=a+r*o,u=l+s*o,f=c-r*o,m=d-s*o,p=i.y+e.config.viewOffset.top,g=i.x+e.config.viewOffset.left,y=i.y-e.config.viewOffset.bottom+n.height,v=i.x-e.config.viewOffset.right+n.width;return t<y&&f>p&&u<v&&m>g}()||function(){return"fixed"===window.getComputedStyle(e.domEl).position}()}function L(){}var S,k;o.prototype.defaults={origin:"bottom",distance:"20px",duration:500,delay:0,rotate:{x:0,y:0,z:0},opacity:0,scale:.9,easing:"cubic-bezier(0.6, 0.2, 0.1, 1)",container:window.document.documentElement,mobile:!0,reset:!1,useDelay:"always",viewFactor:.2,viewOffset:{top:0,right:0,bottom:0,left:0},beforeReveal:function(e){},beforeReset:function(e){},afterReveal:function(e){},afterReset:function(e){}},o.prototype.isSupported=function(){var e=document.documentElement.style;return"WebkitTransition"in e&&"WebkitTransform"in e||"transition"in e&&"transform"in e},o.prototype.reveal=function(e,t,n,i){var o,d,u,g,y,v;if(void 0!==t&&"number"==typeof t?(n=t,t={}):void 0!==t&&null!==t||(t={}),o=r(t),d=s(e,o),!d.length)return console.log('ScrollReveal: reveal on "'+e+'" failed, no elements found.'),S;n&&"number"==typeof n&&(v=a(),y=S.sequences[v]={id:v,interval:n,elemIds:[],active:!1});for(var b=0;b<d.length;b++)g=d[b].getAttribute("data-sr-id"),g?u=S.store.elements[g]:(u={id:a(),domEl:d[b],seen:!1,revealing:!1},u.domEl.setAttribute("data-sr-id",u.id)),y&&(u.sequence={id:y.id,index:y.elemIds.length},y.elemIds.push(u.id)),l(u,t,o),c(u),f(u),S.tools.isMobile()&&!u.config.mobile||!S.isSupported()?(u.domEl.setAttribute("style",u.styles.inline),u.disabled=!0):u.revealing||u.domEl.setAttribute("style",u.styles.inline+u.styles.transform.initial);return!i&&S.isSupported()&&(m(e,t,n),S.initTimeout&&window.clearTimeout(S.initTimeout),S.initTimeout=window.setTimeout(p,0)),S},o.prototype.sync=function(){if(S.history.length&&S.isSupported()){for(var e=0;e<S.history.length;e++){var t=S.history[e];S.reveal(t.target,t.config,t.interval,!0)}p()}else console.log("ScrollReveal: sync failed, no reveals found.");return S},L.prototype.isObject=function(e){return null!==e&&"object"==typeof e&&e.constructor===Object},L.prototype.isNode=function(e){return"object"==typeof window.Node?e instanceof window.Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},L.prototype.isNodeList=function(e){var t=Object.prototype.toString.call(e),n=/^\[object (HTMLCollection|NodeList|Object)\]$/;return"object"==typeof window.NodeList?e instanceof window.NodeList:e&&"object"==typeof e&&n.test(t)&&"number"==typeof e.length&&(0===e.length||this.isNode(e[0]))},L.prototype.forOwn=function(e,t){if(!this.isObject(e))throw new TypeError('Expected "object", but received "'+typeof e+'".');for(var n in e)e.hasOwnProperty(n)&&t(n)},L.prototype.extend=function(e,t){return this.forOwn(t,function(n){this.isObject(t[n])?(e[n]&&this.isObject(e[n])||(e[n]={}),this.extend(e[n],t[n])):e[n]=t[n]}.bind(this)),e},L.prototype.extendClone=function(e,t){return this.extend(this.extend({},e),t)},L.prototype.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},k=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},void 0!==(i=function(){return o}.call(t,n,t,e))&&(e.exports=i)}()},"./src/about/about.js":function(e,t,n){"use strict";function i(){Object(o.a)(),Object(r.a)()}Object.defineProperty(t,"__esModule",{value:!0});var o=n("./src/scripts/scroll.js"),r=n("./src/scripts/navOnMobile.js"),s=n("./src/styles/userfeeds.scss");n.n(s);"complete"===document.readyState?i():window.addEventListener("load",i)},"./src/scripts/navOnMobile.js":function(e,t,n){"use strict";function i(){var e=document.querySelector(".js-mobileMenu");e.addEventListener("click",function(t){t.preventDefault();var n=e.getAttribute("data-target");void 0!=n&&""!=n&&(e.classList.toggle("is-active"),document.getElementById(n).classList.toggle("is-active"))})}t.a=i},"./src/scripts/scroll.js":function(e,t,n){"use strict";function i(){window.sr=r()({duration:700,viewFactor:.4}),sr.isSupported()?(document.documentElement.classList.add("sr"),sr.reveal(".anim-fade",{distance:"0px",scale:1,duration:1e4}),sr.reveal(".anim-fadeBottom",{origin:"bottom",scale:1,distance:"10px",easing:"ease-in",duration:300}),sr.reveal(".anim-fadeRight",{origin:"right"}),sr.reveal(".anim-fadeLeft",{origin:"left",scale:1,distance:"20px",easing:"cubic-bezier(0.6, 0.3, 0.1, 1)"}),sr.reveal(".anim-fadeTop",{origin:"top"}),sr.reveal(".anim-backToFront",{scale:.5}),sr.reveal(".anim-frontToBack",{scale:1.2})):document.documentElement.classList.remove("sr")}t.a=i;var o=n("./node_modules/scrollreveal/dist/scrollreveal.js"),r=n.n(o)},"./src/styles/userfeeds.scss":function(e,t){}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYWJvdXRfZjZkYTc3YjAzNTU3ZTk5ODI1ZGUuanMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIGY2ZGE3N2IwMzU1N2U5OTgyNWRlIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9zY3JvbGxyZXZlYWwvZGlzdC9zY3JvbGxyZXZlYWwuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Fib3V0L2Fib3V0LmpzIiwid2VicGFjazovLy8uL3NyYy9zY3JpcHRzL25hdk9uTW9iaWxlLmpzIiwid2VicGFjazovLy8uL3NyYy9zY3JpcHRzL3Njcm9sbC5qcyJdLCJuYW1lcyI6WyJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiLi9ub2RlX21vZHVsZXMvc2Nyb2xscmV2ZWFsL2Rpc3Qvc2Nyb2xscmV2ZWFsLmpzIiwiX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18iLCJTY3JvbGxSZXZlYWwiLCJjb25maWciLCJ0aGlzIiwiZ2V0UHJvdG90eXBlT2YiLCJzciIsInZlcnNpb24iLCJ0b29scyIsIlRvb2xzIiwiaXNTdXBwb3J0ZWQiLCJleHRlbmQiLCJkZWZhdWx0cyIsImNvbnRhaW5lciIsIl9yZXNvbHZlQ29udGFpbmVyIiwic3RvcmUiLCJlbGVtZW50cyIsImNvbnRhaW5lcnMiLCJzZXF1ZW5jZXMiLCJoaXN0b3J5IiwidWlkIiwiaW5pdGlhbGl6ZWQiLCJjb25zb2xlIiwibG9nIiwid2luZG93IiwiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaXNOb2RlIiwiX2dldFJldmVhbEVsZW1lbnRzIiwidGFyZ2V0IiwiQXJyYXkiLCJzbGljZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpc05vZGVMaXN0IiwiX25leHRVaWQiLCJfY29uZmlndXJlIiwiZWxlbSIsImV4dGVuZENsb25lIiwib3JpZ2luIiwiYXhpcyIsIl9zdHlsZSIsImNvbXB1dGVkIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImRvbUVsIiwic3R5bGVzIiwidHJhbnNpdGlvbiIsInRyYW5zZm9ybSIsImlubGluZSIsImdldEF0dHJpYnV0ZSIsIm9wYWNpdHkiLCJpbnN0YW50IiwiX2dlbmVyYXRlVHJhbnNpdGlvbiIsImRlbGF5ZWQiLCJkZWxheSIsImluaXRpYWwiLCJfZ2VuZXJhdGVUcmFuc2Zvcm0iLCJkdXJhdGlvbiIsImVhc2luZyIsImNzc0Rpc3RhbmNlIiwidGVzdCIsImRpc3RhbmNlIiwic3Vic3RyIiwicGFyc2VJbnQiLCJzY2FsZSIsInJvdGF0ZSIsIngiLCJ5IiwieiIsIl91cGRhdGVTdG9yZSIsImluZGV4T2YiLCJwdXNoIiwiaWQiLCJfcmVjb3JkIiwiaW50ZXJ2YWwiLCJyZWNvcmQiLCJfaW5pdCIsIl9hbmltYXRlIiwibGVuZ3RoIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9oYW5kbGVyIiwiX3JlcXVlc3RBbmltYXRpb25GcmFtZSIsIl9zZXRBY3RpdmVTZXF1ZW5jZXMiLCJhY3RpdmUiLCJlbGVtSWQiLCJzZXF1ZW5jZSIsImZvck93biIsInNlcXVlbmNlSWQiLCJlbGVtSWRzIiwiX2lzRWxlbVZpc2libGUiLCJfc2hvdWxkVXNlRGVsYXkiLCJfc2hvdWxkUmV2ZWFsIiwiYmVmb3JlUmV2ZWFsIiwic2V0QXR0cmlidXRlIiwiX3F1ZXVlQ2FsbGJhY2siLCJyZXZlYWxpbmciLCJzZWVuIiwiX3F1ZXVlTmV4dEluU2VxdWVuY2UiLCJfc2hvdWxkUmVzZXQiLCJiZWZvcmVSZXNldCIsImVsYXBzZWQiLCJibG9ja2VkIiwidXNlRGVsYXkiLCJ0aW1lciIsIk1hdGgiLCJhYnMiLCJzdGFydGVkIiwiRGF0ZSIsImNsZWFyVGltZW91dCIsImNsb2NrIiwic2V0VGltZW91dCIsInR5cGUiLCJjYWxsYmFjayIsImRpc2FibGVkIiwicmVzZXQiLCJfZ2V0Q29udGFpbmVyIiwid2lkdGgiLCJjbGllbnRXaWR0aCIsImhlaWdodCIsImNsaWVudEhlaWdodCIsIl9nZXRTY3JvbGxlZCIsIm9mZnNldCIsIl9nZXRPZmZzZXQiLCJzY3JvbGxMZWZ0IiwibGVmdCIsInNjcm9sbFRvcCIsInRvcCIsInBhZ2VYT2Zmc2V0IiwicGFnZVlPZmZzZXQiLCJvZmZzZXRUb3AiLCJvZmZzZXRMZWZ0Iiwib2Zmc2V0SGVpZ2h0Iiwib2Zmc2V0V2lkdGgiLCJpc05hTiIsIm9mZnNldFBhcmVudCIsInNjcm9sbGVkIiwidkYiLCJ2aWV3RmFjdG9yIiwiZWxlbUhlaWdodCIsImVsZW1XaWR0aCIsImVsZW1Ub3AiLCJlbGVtTGVmdCIsImVsZW1Cb3R0b20iLCJlbGVtUmlnaHQiLCJib3R0b20iLCJyaWdodCIsInZpZXdUb3AiLCJ2aWV3T2Zmc2V0Iiwidmlld0xlZnQiLCJ2aWV3Qm90dG9tIiwidmlld1JpZ2h0IiwicG9zaXRpb24iLCJtb2JpbGUiLCJhZnRlclJldmVhbCIsImFmdGVyUmVzZXQiLCJzdHlsZSIsInJldmVhbCIsInN5bmMiLCJ1bmRlZmluZWQiLCJpbmRleCIsImlzTW9iaWxlIiwiaW5pdFRpbWVvdXQiLCJpc09iamVjdCIsImNvbnN0cnVjdG9yIiwiTm9kZSIsIm5vZGVUeXBlIiwibm9kZU5hbWUiLCJwcm90b3R5cGVUb1N0cmluZyIsInRvU3RyaW5nIiwicmVnZXgiLCJOb2RlTGlzdCIsIlR5cGVFcnJvciIsInNvdXJjZSIsImJpbmQiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJ3ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCIuL3NyYy9hYm91dC9hYm91dC5qcyIsIl9fd2VicGFja19leHBvcnRzX18iLCJpbml0IiwiX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19zY3JpcHRzX3Njcm9sbF9fIiwiX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19zY3JpcHRzX25hdk9uTW9iaWxlX18iLCJ2YWx1ZSIsIl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fc3R5bGVzX3VzZXJmZWVkc19zY3NzX18iLCJyZWFkeVN0YXRlIiwiLi9zcmMvc2NyaXB0cy9uYXZPbk1vYmlsZS5qcyIsImluaXROYXZPbk1vYmlsZSIsIiRidXR0b24iLCJlIiwicHJldmVudERlZmF1bHQiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJnZXRFbGVtZW50QnlJZCIsIi4vc3JjL3NjcmlwdHMvc2Nyb2xsLmpzIiwiaW5pdFNjcm9sbFJldmVhbCIsIl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9zY3JvbGxyZXZlYWxfX19kZWZhdWx0IiwiYWRkIiwicmVtb3ZlIiwiX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX3Njcm9sbHJldmVhbF9fIiwiLi9zcmMvc3R5bGVzL3VzZXJmZWVkcy5zY3NzIl0sIm1hcHBpbmdzIjoiQ0FBUyxTQUFVQSxHQ0luQixRQUFBQyxHQUFBQyxHQUdBLEdBQUFDLEVBQUFELEdBQ0EsTUFBQUMsR0FBQUQsR0FBQUUsT0FHQSxJQUFBQyxHQUFBRixFQUFBRCxJQUNBSSxFQUFBSixFQUNBSyxHQUFBLEVBQ0FILFdBVUEsT0FOQUosR0FBQUUsR0FBQU0sS0FBQUgsRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUgsR0FHQUksRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQXZCQSxHQUFBRCxLQTRCQUYsR0FBQVEsRUFBQVQsRUFHQUMsRUFBQVMsRUFBQVAsRUFHQUYsRUFBQVUsRUFBQSxTQUFBUCxFQUFBUSxFQUFBQyxHQUNBWixFQUFBYSxFQUFBVixFQUFBUSxJQUNBRyxPQUFBQyxlQUFBWixFQUFBUSxHQUNBSyxjQUFBLEVBQ0FDLFlB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USxTQUFVeUIsTUFBTSxFQUFHSCxTQUFTLE9BQVFILE9BQVEsVUFBV0QsU0FBUyxNQUN2R25ELEdBQUdzSixPQUFPLG1CQUFxQnJILE9BQVEsVUFDdkNqQyxHQUFHc0osT0FBTyxrQkFBb0JySCxPQUFRLE9BQVN5QixNQUFPLEVBQUdILFNBQVMsT0FBUUgsT0FBUSxtQ0FDbEZwRCxHQUFHc0osT0FBTyxpQkFBbUJySCxPQUFRLFFBQ3JDakMsR0FBR3NKLE9BQU8scUJBQXVCNUYsTUFBTyxLQUN4QzFELEdBQUdzSixPQUFPLHFCQUF1QjVGLE1BQU8sT0FFeEN2QyxTQUFTQyxnQkFBZ0JzSyxVQUFVTyxPQUFPLE1MNDhCYm5CLEVBQXVCLEVBQUlnQixDQUN2QyxJQUFJSSxHQUE2Q25PLEVBQW9CLG9EQUNqRWdPLEVBQXFEaE8sRUFBb0JtQixFQUFFZ04sSUF1QjlGQyw4QkFDQSxTQUFVaE8sRUFBUUQiLCJmaWxlIjoiYWJvdXRfZjZkYTc3YjAzNTU3ZTk5ODI1ZGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4vKioqKioqLyBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4vKioqKioqLyBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbi8qKioqKiovIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuLyoqKioqKi8gXHRcdH1cbi8qKioqKiovIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuLyoqKioqKi8gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbi8qKioqKiovIFx0XHRcdGk6IG1vZHVsZUlkLFxuLyoqKioqKi8gXHRcdFx0bDogZmFsc2UsXG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fVxuLyoqKioqKi8gXHRcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuLyoqKioqKi8gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuLyoqKioqKi9cbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuLyoqKioqKi8gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbi8qKioqKiovIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4vKioqKioqLyBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4vKioqKioqLyBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4vKioqKioqLyBcdFx0XHRcdGdldDogZ2V0dGVyXG4vKioqKioqLyBcdFx0XHR9KTtcbi8qKioqKiovIFx0XHR9XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbi8qKioqKiovIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4vKioqKioqLyBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuLyoqKioqKi8gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbi8qKioqKiovIFx0XHRyZXR1cm4gZ2V0dGVyO1xuLyoqKioqKi8gXHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gXCIuL3NyYy9hYm91dC9hYm91dC5qc1wiKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKHtcblxuLyoqKi8gXCIuL25vZGVfbW9kdWxlcy9zY3JvbGxyZXZlYWwvZGlzdC9zY3JvbGxyZXZlYWwuanNcIjpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxudmFyIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fOy8vLy8vICAgIC8vLy8vICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAvLy8vLyAgICAvLy8vLyAgICAvLy8vL1xuLy8vLy8gICAgLy8vLy8gICAgLy8vLy8gICAgLy8vLy9cbi8vLy8vICAgIC8vLy8vICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAgICAgICAgICAvLy8vLyAgICAvLy8vL1xuLy8vLy8gICAgICAgICAgICAgLy8vLy8gICAgLy8vLy9cbi8vLy8vICAgIC8vLy8vICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAvLy8vLyAgICAvLy8vLyAgICAvLy8vL1xuICAgICAgICAgLy8vLy8gICAgLy8vLy9cbiAgICAgICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAvLy8vLyAgICAvLy8vLyAgICAvLy8vL1xuLy8vLy8gICAgLy8vLy8gICAgLy8vLy8gICAgLy8vLy9cbi8vLy8vICAgIC8vLy8vICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAvLy8vLyAgICAvLy8vLyAgICAvLy8vL1xuXG4vKipcbiAqIFNjcm9sbFJldmVhbFxuICogLS0tLS0tLS0tLS0tXG4gKiBWZXJzaW9uIDogMy4zLjZcbiAqIFdlYnNpdGUgOiBzY3JvbGxyZXZlYWxqcy5vcmdcbiAqIFJlcG8gICAgOiBnaXRodWIuY29tL2psbWFrZXMvc2Nyb2xscmV2ZWFsLmpzXG4gKiBBdXRob3IgIDogSnVsaWFuIExsb3lkIChAamxtYWtlcylcbiAqL1xuXG47KGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnXG5cbiAgdmFyIHNyXG4gIHZhciBfcmVxdWVzdEFuaW1hdGlvbkZyYW1lXG5cbiAgZnVuY3Rpb24gU2Nyb2xsUmV2ZWFsIChjb25maWcpIHtcbiAgICAvLyBTdXBwb3J0IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgYG5ld2Aga2V5d29yZC5cbiAgICBpZiAodHlwZW9mIHRoaXMgPT09ICd1bmRlZmluZWQnIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSAhPT0gU2Nyb2xsUmV2ZWFsLnByb3RvdHlwZSkge1xuICAgICAgcmV0dXJuIG5ldyBTY3JvbGxSZXZlYWwoY29uZmlnKVxuICAgIH1cblxuICAgIHNyID0gdGhpcyAvLyBTYXZlIHJlZmVyZW5jZSB0byBpbnN0YW5jZS5cbiAgICBzci52ZXJzaW9uID0gJzMuMy42J1xuICAgIHNyLnRvb2xzID0gbmV3IFRvb2xzKCkgLy8gKnJlcXVpcmVkIHV0aWxpdGllc1xuXG4gICAgaWYgKHNyLmlzU3VwcG9ydGVkKCkpIHtcbiAgICAgIHNyLnRvb2xzLmV4dGVuZChzci5kZWZhdWx0cywgY29uZmlnIHx8IHt9KVxuXG4gICAgICBzci5kZWZhdWx0cy5jb250YWluZXIgPSBfcmVzb2x2ZUNvbnRhaW5lcihzci5kZWZhdWx0cylcblxuICAgICAgc3Iuc3RvcmUgPSB7XG4gICAgICAgIGVsZW1lbnRzOiB7fSxcbiAgICAgICAgY29udGFpbmVyczogW11cbiAgICAgIH1cblxuICAgICAgc3Iuc2VxdWVuY2VzID0ge31cbiAgICAgIHNyLmhpc3RvcnkgPSBbXVxuICAgICAgc3IudWlkID0gMFxuICAgICAgc3IuaW5pdGlhbGl6ZWQgPSBmYWxzZVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUgIT09IG51bGwpIHtcbiAgICAgIC8vIE5vdGU6IElFOSBvbmx5IHN1cHBvcnRzIGNvbnNvbGUgaWYgZGV2dG9vbHMgYXJlIG9wZW4uXG4gICAgICBjb25zb2xlLmxvZygnU2Nyb2xsUmV2ZWFsIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyLicpXG4gICAgfVxuXG4gICAgcmV0dXJuIHNyXG4gIH1cblxuICAvKipcbiAgICogQ29uZmlndXJhdGlvblxuICAgKiAtLS0tLS0tLS0tLS0tXG4gICAqIFRoaXMgb2JqZWN0IHNpZ25hdHVyZSBjYW4gYmUgcGFzc2VkIGRpcmVjdGx5IHRvIHRoZSBTY3JvbGxSZXZlYWwgY29uc3RydWN0b3IsXG4gICAqIG9yIGFzIHRoZSBzZWNvbmQgYXJndW1lbnQgb2YgdGhlIGByZXZlYWwoKWAgbWV0aG9kLlxuICAgKi9cblxuICBTY3JvbGxSZXZlYWwucHJvdG90eXBlLmRlZmF1bHRzID0ge1xuICAgIC8vICdib3R0b20nLCAnbGVmdCcsICd0b3AnLCAncmlnaHQnXG4gICAgb3JpZ2luOiAnYm90dG9tJyxcblxuICAgIC8vIENhbiBiZSBhbnkgdmFsaWQgQ1NTIGRpc3RhbmNlLCBlLmcuICc1cmVtJywgJzEwJScsICcyMHZ3JywgZXRjLlxuICAgIGRpc3RhbmNlOiAnMjBweCcsXG5cbiAgICAvLyBUaW1lIGluIG1pbGxpc2Vjb25kcy5cbiAgICBkdXJhdGlvbjogNTAwLFxuICAgIGRlbGF5OiAwLFxuXG4gICAgLy8gU3RhcnRpbmcgYW5nbGVzIGluIGRlZ3JlZXMsIHdpbGwgdHJhbnNpdGlvbiBmcm9tIHRoZXNlIHZhbHVlcyB0byAwIGluIGFsbCBheGVzLlxuICAgIHJvdGF0ZTogeyB4OiAwLCB5OiAwLCB6OiAwIH0sXG5cbiAgICAvLyBTdGFydGluZyBvcGFjaXR5IHZhbHVlLCBiZWZvcmUgdHJhbnNpdGlvbmluZyB0byB0aGUgY29tcHV0ZWQgb3BhY2l0eS5cbiAgICBvcGFjaXR5OiAwLFxuXG4gICAgLy8gU3RhcnRpbmcgc2NhbGUgdmFsdWUsIHdpbGwgdHJhbnNpdGlvbiBmcm9tIHRoaXMgdmFsdWUgdG8gMVxuICAgIHNjYWxlOiAwLjksXG5cbiAgICAvLyBBY2NlcHRzIGFueSB2YWxpZCBDU1MgZWFzaW5nLCBlLmcuICdlYXNlJywgJ2Vhc2UtaW4tb3V0JywgJ2xpbmVhcicsIGV0Yy5cbiAgICBlYXNpbmc6ICdjdWJpYy1iZXppZXIoMC42LCAwLjIsIDAuMSwgMSknLFxuXG4gICAgLy8gYDxodG1sPmAgaXMgdGhlIGRlZmF1bHQgcmV2ZWFsIGNvbnRhaW5lci4gWW91IGNhbiBwYXNzIGVpdGhlcjpcbiAgICAvLyBET00gTm9kZSwgZS5nLiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9vQ29udGFpbmVyJylcbiAgICAvLyBTZWxlY3RvciwgZS5nLiAnLmZvb0NvbnRhaW5lcidcbiAgICBjb250YWluZXI6IHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsXG5cbiAgICAvLyB0cnVlL2ZhbHNlIHRvIGNvbnRyb2wgcmV2ZWFsIGFuaW1hdGlvbnMgb24gbW9iaWxlLlxuICAgIG1vYmlsZTogdHJ1ZSxcblxuICAgIC8vIHRydWU6ICByZXZlYWxzIG9jY3VyIGV2ZXJ5IHRpbWUgZWxlbWVudHMgYmVjb21lIHZpc2libGVcbiAgICAvLyBmYWxzZTogcmV2ZWFscyBvY2N1ciBvbmNlIGFzIGVsZW1lbnRzIGJlY29tZSB2aXNpYmxlXG4gICAgcmVzZXQ6IGZhbHNlLFxuXG4gICAgLy8gJ2Fsd2F5cycg4oCUIGRlbGF5IGZvciBhbGwgcmV2ZWFsIGFuaW1hdGlvbnNcbiAgICAvLyAnb25jZScgICDigJQgZGVsYXkgb25seSB0aGUgZmlyc3QgdGltZSByZXZlYWxzIG9jY3VyXG4gICAgLy8gJ29ubG9hZCcgLSBkZWxheSBvbmx5IGZvciBhbmltYXRpb25zIHRyaWdnZXJlZCBieSBmaXJzdCBsb2FkXG4gICAgdXNlRGVsYXk6ICdhbHdheXMnLFxuXG4gICAgLy8gQ2hhbmdlIHdoZW4gYW4gZWxlbWVudCBpcyBjb25zaWRlcmVkIGluIHRoZSB2aWV3cG9ydC4gVGhlIGRlZmF1bHQgdmFsdWVcbiAgICAvLyBvZiAwLjIwIG1lYW5zIDIwJSBvZiBhbiBlbGVtZW50IG11c3QgYmUgdmlzaWJsZSBmb3IgaXRzIHJldmVhbCB0byBvY2N1ci5cbiAgICB2aWV3RmFjdG9yOiAwLjIsXG5cbiAgICAvLyBQaXhlbCB2YWx1ZXMgdGhhdCBhbHRlciB0aGUgY29udGFpbmVyIGJvdW5kYXJpZXMuXG4gICAgLy8gZS5nLiBTZXQgYHsgdG9wOiA0OCB9YCwgaWYgeW91IGhhdmUgYSA0OHB4IHRhbGwgZml4ZWQgdG9vbGJhci5cbiAgICAvLyAtLVxuICAgIC8vIFZpc3VhbCBBaWQ6IGh0dHBzOi8vc2Nyb2xscmV2ZWFsanMub3JnL2Fzc2V0cy92aWV3b2Zmc2V0LnBuZ1xuICAgIHZpZXdPZmZzZXQ6IHsgdG9wOiAwLCByaWdodDogMCwgYm90dG9tOiAwLCBsZWZ0OiAwIH0sXG5cbiAgICAvLyBDYWxsYmFja3MgdGhhdCBmaXJlIGZvciBlYWNoIHRyaWdnZXJlZCBlbGVtZW50IHJldmVhbCwgYW5kIHJlc2V0LlxuICAgIGJlZm9yZVJldmVhbDogZnVuY3Rpb24gKGRvbUVsKSB7fSxcbiAgICBiZWZvcmVSZXNldDogZnVuY3Rpb24gKGRvbUVsKSB7fSxcblxuICAgIC8vIENhbGxiYWNrcyB0aGF0IGZpcmUgZm9yIGVhY2ggY29tcGxldGVkIGVsZW1lbnQgcmV2ZWFsLCBhbmQgcmVzZXQuXG4gICAgYWZ0ZXJSZXZlYWw6IGZ1bmN0aW9uIChkb21FbCkge30sXG4gICAgYWZ0ZXJSZXNldDogZnVuY3Rpb24gKGRvbUVsKSB7fVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGNsaWVudCBzdXBwb3J0cyBDU1MgVHJhbnNmb3JtIGFuZCBDU1MgVHJhbnNpdGlvbi5cbiAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICovXG4gIFNjcm9sbFJldmVhbC5wcm90b3R5cGUuaXNTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlXG4gICAgcmV0dXJuICdXZWJraXRUcmFuc2l0aW9uJyBpbiBzdHlsZSAmJiAnV2Via2l0VHJhbnNmb3JtJyBpbiBzdHlsZSB8fFxuICAgICAgJ3RyYW5zaXRpb24nIGluIHN0eWxlICYmICd0cmFuc2Zvcm0nIGluIHN0eWxlXG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIHJldmVhbCBzZXQsIGEgZ3JvdXAgb2YgZWxlbWVudHMgdGhhdCB3aWxsIGFuaW1hdGUgd2hlbiB0aGV5XG4gICAqIGJlY29tZSB2aXNpYmxlLiBJZiBbaW50ZXJ2YWxdIGlzIHByb3ZpZGVkLCBhIG5ldyBzZXF1ZW5jZSBpcyBjcmVhdGVkXG4gICAqIHRoYXQgd2lsbCBlbnN1cmUgZWxlbWVudHMgcmV2ZWFsIGluIHRoZSBvcmRlciB0aGV5IGFwcGVhciBpbiB0aGUgRE9NLlxuICAgKlxuICAgKiBAcGFyYW0ge05vZGV8Tm9kZUxpc3R8c3RyaW5nfSBbdGFyZ2V0XSAgIFRoZSBub2RlLCBub2RlIGxpc3Qgb3Igc2VsZWN0b3IgdG8gdXNlIGZvciBhbmltYXRpb24uXG4gICAqIEBwYXJhbSB7T2JqZWN0fSAgICAgICAgICAgICAgIFtjb25maWddICAgT3ZlcnJpZGUgdGhlIGRlZmF1bHRzIGZvciB0aGlzIHJldmVhbCBzZXQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSAgICAgICAgICAgICAgIFtpbnRlcnZhbF0gVGltZSBiZXR3ZWVuIHNlcXVlbmNlZCBlbGVtZW50IGFuaW1hdGlvbnMgKG1pbGxpc2Vjb25kcykuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gICAgICAgICAgICAgIFtzeW5jXSAgICAgVXNlZCBpbnRlcm5hbGx5IHdoZW4gdXBkYXRpbmcgcmV2ZWFscyBmb3IgYXN5bmMgY29udGVudC5cbiAgICpcbiAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgY3VycmVudCBTY3JvbGxSZXZlYWwgaW5zdGFuY2UuXG4gICAqL1xuICBTY3JvbGxSZXZlYWwucHJvdG90eXBlLnJldmVhbCA9IGZ1bmN0aW9uICh0YXJnZXQsIGNvbmZpZywgaW50ZXJ2YWwsIHN5bmMpIHtcbiAgICB2YXIgY29udGFpbmVyXG4gICAgdmFyIGVsZW1lbnRzXG4gICAgdmFyIGVsZW1cbiAgICB2YXIgZWxlbUlkXG4gICAgdmFyIHNlcXVlbmNlXG4gICAgdmFyIHNlcXVlbmNlSWRcblxuICAgIC8vIE5vIGN1c3RvbSBjb25maWd1cmF0aW9uIHdhcyBwYXNzZWQsIGJ1dCBhIHNlcXVlbmNlIGludGVydmFsIGluc3RlYWQuXG4gICAgLy8gbGV04oCZcyBzaHVmZmxlIHRoaW5ncyBhcm91bmQgdG8gbWFrZSBzdXJlIGV2ZXJ5dGhpbmcgd29ya3MuXG4gICAgaWYgKGNvbmZpZyAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBjb25maWcgPT09ICdudW1iZXInKSB7XG4gICAgICBpbnRlcnZhbCA9IGNvbmZpZ1xuICAgICAgY29uZmlnID0ge31cbiAgICB9IGVsc2UgaWYgKGNvbmZpZyA9PT0gdW5kZWZpbmVkIHx8IGNvbmZpZyA9PT0gbnVsbCkge1xuICAgICAgY29uZmlnID0ge31cbiAgICB9XG5cbiAgICBjb250YWluZXIgPSBfcmVzb2x2ZUNvbnRhaW5lcihjb25maWcpXG4gICAgZWxlbWVudHMgPSBfZ2V0UmV2ZWFsRWxlbWVudHModGFyZ2V0LCBjb250YWluZXIpXG5cbiAgICBpZiAoIWVsZW1lbnRzLmxlbmd0aCkge1xuICAgICAgY29uc29sZS5sb2coJ1Njcm9sbFJldmVhbDogcmV2ZWFsIG9uIFwiJyArIHRhcmdldCArICdcIiBmYWlsZWQsIG5vIGVsZW1lbnRzIGZvdW5kLicpXG4gICAgICByZXR1cm4gc3JcbiAgICB9XG5cbiAgICAvLyBQcmVwYXJlIGEgbmV3IHNlcXVlbmNlIGlmIGFuIGludGVydmFsIGlzIHBhc3NlZC5cbiAgICBpZiAoaW50ZXJ2YWwgJiYgdHlwZW9mIGludGVydmFsID09PSAnbnVtYmVyJykge1xuICAgICAgc2VxdWVuY2VJZCA9IF9uZXh0VWlkKClcblxuICAgICAgc2VxdWVuY2UgPSBzci5zZXF1ZW5jZXNbc2VxdWVuY2VJZF0gPSB7XG4gICAgICAgIGlkOiBzZXF1ZW5jZUlkLFxuICAgICAgICBpbnRlcnZhbDogaW50ZXJ2YWwsXG4gICAgICAgIGVsZW1JZHM6IFtdLFxuICAgICAgICBhY3RpdmU6IGZhbHNlXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQmVnaW4gbWFpbiBsb29wIHRvIGNvbmZpZ3VyZSBTY3JvbGxSZXZlYWwgZWxlbWVudHMuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgLy8gQ2hlY2sgaWYgdGhlIGVsZW1lbnQgaGFzIGFscmVhZHkgYmVlbiBjb25maWd1cmVkIGFuZCBncmFiIGl0IGZyb20gdGhlIHN0b3JlLlxuICAgICAgZWxlbUlkID0gZWxlbWVudHNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXNyLWlkJylcbiAgICAgIGlmIChlbGVtSWQpIHtcbiAgICAgICAgZWxlbSA9IHNyLnN0b3JlLmVsZW1lbnRzW2VsZW1JZF1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE90aGVyd2lzZSwgbGV04oCZcyBkbyBzb21lIGJhc2ljIHNldHVwLlxuICAgICAgICBlbGVtID0ge1xuICAgICAgICAgIGlkOiBfbmV4dFVpZCgpLFxuICAgICAgICAgIGRvbUVsOiBlbGVtZW50c1tpXSxcbiAgICAgICAgICBzZWVuOiBmYWxzZSxcbiAgICAgICAgICByZXZlYWxpbmc6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgICAgZWxlbS5kb21FbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3ItaWQnLCBlbGVtLmlkKVxuICAgICAgfVxuXG4gICAgICAvLyBTZXF1ZW5jZSBvbmx5IHNldHVwXG4gICAgICBpZiAoc2VxdWVuY2UpIHtcbiAgICAgICAgZWxlbS5zZXF1ZW5jZSA9IHtcbiAgICAgICAgICBpZDogc2VxdWVuY2UuaWQsXG4gICAgICAgICAgaW5kZXg6IHNlcXVlbmNlLmVsZW1JZHMubGVuZ3RoXG4gICAgICAgIH1cblxuICAgICAgICBzZXF1ZW5jZS5lbGVtSWRzLnB1c2goZWxlbS5pZClcbiAgICAgIH1cblxuICAgICAgLy8gTmV3IG9yIGV4aXN0aW5nIGVsZW1lbnQsIGl04oCZcyB0aW1lIHRvIHVwZGF0ZSBpdHMgY29uZmlndXJhdGlvbiwgc3R5bGVzLFxuICAgICAgLy8gYW5kIHNlbmQgdGhlIHVwZGF0ZXMgdG8gb3VyIHN0b3JlLlxuICAgICAgX2NvbmZpZ3VyZShlbGVtLCBjb25maWcsIGNvbnRhaW5lcilcbiAgICAgIF9zdHlsZShlbGVtKVxuICAgICAgX3VwZGF0ZVN0b3JlKGVsZW0pXG5cbiAgICAgIC8vIFdlIG5lZWQgdG8gbWFrZSBzdXJlIGVsZW1lbnRzIGFyZSBzZXQgdG8gdmlzaWJpbGl0eTogdmlzaWJsZSwgZXZlbiB3aGVuXG4gICAgICAvLyBvbiBtb2JpbGUgYW5kIGBjb25maWcubW9iaWxlID09PSBmYWxzZWAsIG9yIGlmIHVuc3VwcG9ydGVkLlxuICAgICAgaWYgKHNyLnRvb2xzLmlzTW9iaWxlKCkgJiYgIWVsZW0uY29uZmlnLm1vYmlsZSB8fCAhc3IuaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICBlbGVtLmRvbUVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBlbGVtLnN0eWxlcy5pbmxpbmUpXG4gICAgICAgIGVsZW0uZGlzYWJsZWQgPSB0cnVlXG4gICAgICB9IGVsc2UgaWYgKCFlbGVtLnJldmVhbGluZykge1xuICAgICAgICAvLyBPdGhlcndpc2UsIHByb2NlZWQgbm9ybWFsbHkuXG4gICAgICAgIGVsZW0uZG9tRWwuc2V0QXR0cmlidXRlKCdzdHlsZScsXG4gICAgICAgICAgZWxlbS5zdHlsZXMuaW5saW5lICtcbiAgICAgICAgICBlbGVtLnN0eWxlcy50cmFuc2Zvcm0uaW5pdGlhbFxuICAgICAgICApXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRWFjaCBgcmV2ZWFsKClgIGlzIHJlY29yZGVkIHNvIHRoYXQgd2hlbiBjYWxsaW5nIGBzeW5jKClgIHdoaWxlIHdvcmtpbmdcbiAgICAvLyB3aXRoIGFzeW5jaHJvbm91c2x5IGxvYWRlZCBjb250ZW50LCBpdCBjYW4gcmUtdHJhY2UgeW91ciBzdGVwcyBidXQgd2l0aFxuICAgIC8vIGFsbCB5b3VyIG5ldyBlbGVtZW50cyBub3cgaW4gdGhlIERPTS5cblxuICAgIC8vIFNpbmNlIGByZXZlYWwoKWAgaXMgY2FsbGVkIGludGVybmFsbHkgYnkgYHN5bmMoKWAsIHdlIGRvbuKAmXQgd2FudCB0b1xuICAgIC8vIHJlY29yZCBvciBpbnRpaWFsaXplIGVhY2ggcmV2ZWFsIGR1cmluZyBzeW5jaW5nLlxuICAgIGlmICghc3luYyAmJiBzci5pc1N1cHBvcnRlZCgpKSB7XG4gICAgICBfcmVjb3JkKHRhcmdldCwgY29uZmlnLCBpbnRlcnZhbClcblxuICAgICAgLy8gV2UgcHVzaCBpbml0aWFsaXphdGlvbiB0byB0aGUgZXZlbnQgcXVldWUgdXNpbmcgc2V0VGltZW91dCwgc28gdGhhdCB3ZSBjYW5cbiAgICAgIC8vIGdpdmUgU2Nyb2xsUmV2ZWFsIHJvb20gdG8gcHJvY2VzcyBhbGwgcmV2ZWFsIGNhbGxzIGJlZm9yZSBwdXR0aW5nIHRoaW5ncyBpbnRvIG1vdGlvbi5cbiAgICAgIC8vIC0tXG4gICAgICAvLyBQaGlsaXAgUm9iZXJ0cyAtIFdoYXQgdGhlIGhlY2sgaXMgdGhlIGV2ZW50IGxvb3AgYW55d2F5PyAoSlNDb25mIEVVIDIwMTQpXG4gICAgICAvLyBodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PThhR2haUWtvRmJRXG4gICAgICBpZiAoc3IuaW5pdFRpbWVvdXQpIHtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChzci5pbml0VGltZW91dClcbiAgICAgIH1cbiAgICAgIHNyLmluaXRUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoX2luaXQsIDApXG4gICAgfVxuXG4gICAgcmV0dXJuIHNyXG4gIH1cblxuICAvKipcbiAgICogUmUtcnVucyBgcmV2ZWFsKClgIGZvciBlYWNoIHJlY29yZCBzdG9yZWQgaW4gaGlzdG9yeSwgZWZmZWN0aXZlbHkgY2FwdHVyaW5nXG4gICAqIGFueSBjb250ZW50IGxvYWRlZCBhc3luY2hyb25vdXNseSB0aGF0IG1hdGNoZXMgZXhpc3RpbmcgcmV2ZWFsIHNldCB0YXJnZXRzLlxuICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBjdXJyZW50IFNjcm9sbFJldmVhbCBpbnN0YW5jZS5cbiAgICovXG4gIFNjcm9sbFJldmVhbC5wcm90b3R5cGUuc3luYyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoc3IuaGlzdG9yeS5sZW5ndGggJiYgc3IuaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzci5oaXN0b3J5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciByZWNvcmQgPSBzci5oaXN0b3J5W2ldXG4gICAgICAgIHNyLnJldmVhbChyZWNvcmQudGFyZ2V0LCByZWNvcmQuY29uZmlnLCByZWNvcmQuaW50ZXJ2YWwsIHRydWUpXG4gICAgICB9XG4gICAgICBfaW5pdCgpXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKCdTY3JvbGxSZXZlYWw6IHN5bmMgZmFpbGVkLCBubyByZXZlYWxzIGZvdW5kLicpXG4gICAgfVxuICAgIHJldHVybiBzclxuICB9XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgTWV0aG9kc1xuICAgKiAtLS0tLS0tLS0tLS0tLS1cbiAgICovXG5cbiAgZnVuY3Rpb24gX3Jlc29sdmVDb250YWluZXIgKGNvbmZpZykge1xuICAgIGlmIChjb25maWcgJiYgY29uZmlnLmNvbnRhaW5lcikge1xuICAgICAgaWYgKHR5cGVvZiBjb25maWcuY29udGFpbmVyID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5jb250YWluZXIpXG4gICAgICB9IGVsc2UgaWYgKHNyLnRvb2xzLmlzTm9kZShjb25maWcuY29udGFpbmVyKSkge1xuICAgICAgICByZXR1cm4gY29uZmlnLmNvbnRhaW5lclxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1Njcm9sbFJldmVhbDogaW52YWxpZCBjb250YWluZXIgXCInICsgY29uZmlnLmNvbnRhaW5lciArICdcIiBwcm92aWRlZC4nKVxuICAgICAgICBjb25zb2xlLmxvZygnU2Nyb2xsUmV2ZWFsOiBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdCBjb250YWluZXIuJylcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNyLmRlZmF1bHRzLmNvbnRhaW5lclxuICB9XG5cbiAgLyoqXG4gICAqIGNoZWNrIHRvIHNlZSBpZiBhIG5vZGUgb3Igbm9kZSBsaXN0IHdhcyBwYXNzZWQgaW4gYXMgdGhlIHRhcmdldCxcbiAgICogb3RoZXJ3aXNlIHF1ZXJ5IHRoZSBjb250YWluZXIgdXNpbmcgdGFyZ2V0IGFzIGEgc2VsZWN0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7Tm9kZXxOb2RlTGlzdHxzdHJpbmd9IFt0YXJnZXRdICAgIGNsaWVudCBpbnB1dCBmb3IgcmV2ZWFsIHRhcmdldC5cbiAgICogQHBhcmFtIHtOb2RlfSAgICAgICAgICAgICAgICAgW2NvbnRhaW5lcl0gcGFyZW50IGVsZW1lbnQgZm9yIHNlbGVjdG9yIHF1ZXJpZXMuXG4gICAqXG4gICAqIEByZXR1cm4ge2FycmF5fSBlbGVtZW50cyB0byBiZSByZXZlYWxlZC5cbiAgICovXG4gIGZ1bmN0aW9uIF9nZXRSZXZlYWxFbGVtZW50cyAodGFyZ2V0LCBjb250YWluZXIpIHtcbiAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCh0YXJnZXQpKVxuICAgIH0gZWxzZSBpZiAoc3IudG9vbHMuaXNOb2RlKHRhcmdldCkpIHtcbiAgICAgIHJldHVybiBbdGFyZ2V0XVxuICAgIH0gZWxzZSBpZiAoc3IudG9vbHMuaXNOb2RlTGlzdCh0YXJnZXQpKSB7XG4gICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGFyZ2V0KVxuICAgIH1cbiAgICByZXR1cm4gW11cbiAgfVxuXG4gIC8qKlxuICAgKiBBIGNvbnNpc3RlbnQgd2F5IG9mIGNyZWF0aW5nIHVuaXF1ZSBJRHMuXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAqL1xuICBmdW5jdGlvbiBfbmV4dFVpZCAoKSB7XG4gICAgcmV0dXJuICsrc3IudWlkXG4gIH1cblxuICBmdW5jdGlvbiBfY29uZmlndXJlIChlbGVtLCBjb25maWcsIGNvbnRhaW5lcikge1xuICAgIC8vIElmIGEgY29udGFpbmVyIHdhcyBwYXNzZWQgYXMgYSBwYXJ0IG9mIHRoZSBjb25maWcgb2JqZWN0LFxuICAgIC8vIGxldOKAmXMgb3ZlcndyaXRlIGl0IHdpdGggdGhlIHJlc29sdmVkIGNvbnRhaW5lciBwYXNzZWQgaW4uXG4gICAgaWYgKGNvbmZpZy5jb250YWluZXIpIGNvbmZpZy5jb250YWluZXIgPSBjb250YWluZXJcbiAgICAvLyBJZiB0aGUgZWxlbWVudCBoYXNu4oCZdCBhbHJlYWR5IGJlZW4gY29uZmlndXJlZCwgbGV04oCZcyB1c2UgYSBjbG9uZSBvZiB0aGVcbiAgICAvLyBkZWZhdWx0cyBleHRlbmRlZCBieSB0aGUgY29uZmlndXJhdGlvbiBwYXNzZWQgYXMgdGhlIHNlY29uZCBhcmd1bWVudC5cbiAgICBpZiAoIWVsZW0uY29uZmlnKSB7XG4gICAgICBlbGVtLmNvbmZpZyA9IHNyLnRvb2xzLmV4dGVuZENsb25lKHNyLmRlZmF1bHRzLCBjb25maWcpXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE90aGVyd2lzZSwgbGV04oCZcyB1c2UgYSBjbG9uZSBvZiB0aGUgZXhpc3RpbmcgZWxlbWVudCBjb25maWd1cmF0aW9uIGV4dGVuZGVkXG4gICAgICAvLyBieSB0aGUgY29uZmlndXJhdGlvbiBwYXNzZWQgYXMgdGhlIHNlY29uZCBhcmd1bWVudC5cbiAgICAgIGVsZW0uY29uZmlnID0gc3IudG9vbHMuZXh0ZW5kQ2xvbmUoZWxlbS5jb25maWcsIGNvbmZpZylcbiAgICB9XG5cbiAgICAvLyBJbmZlciBDU1MgVHJhbnNmb3JtIGF4aXMgZnJvbSBvcmlnaW4gc3RyaW5nLlxuICAgIGlmIChlbGVtLmNvbmZpZy5vcmlnaW4gPT09ICd0b3AnIHx8IGVsZW0uY29uZmlnLm9yaWdpbiA9PT0gJ2JvdHRvbScpIHtcbiAgICAgIGVsZW0uY29uZmlnLmF4aXMgPSAnWSdcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbS5jb25maWcuYXhpcyA9ICdYJ1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9zdHlsZSAoZWxlbSkge1xuICAgIHZhciBjb21wdXRlZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW0uZG9tRWwpXG5cbiAgICBpZiAoIWVsZW0uc3R5bGVzKSB7XG4gICAgICBlbGVtLnN0eWxlcyA9IHtcbiAgICAgICAgdHJhbnNpdGlvbjoge30sXG4gICAgICAgIHRyYW5zZm9ybToge30sXG4gICAgICAgIGNvbXB1dGVkOiB7fVxuICAgICAgfVxuXG4gICAgICAvLyBDYXB0dXJlIGFueSBleGlzdGluZyBpbmxpbmUgc3R5bGVzLCBhbmQgYWRkIG91ciB2aXNpYmlsaXR5IG92ZXJyaWRlLlxuICAgICAgLy8gLS1cbiAgICAgIC8vIFNlZSBzZWN0aW9uIDQuMi4gaW4gdGhlIERvY3VtZW50YXRpb246XG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vamxtYWtlcy9zY3JvbGxyZXZlYWwuanMjNDItaW1wcm92ZS11c2VyLWV4cGVyaWVuY2VcbiAgICAgIGVsZW0uc3R5bGVzLmlubGluZSA9IGVsZW0uZG9tRWwuZ2V0QXR0cmlidXRlKCdzdHlsZScpIHx8ICcnXG4gICAgICBlbGVtLnN0eWxlcy5pbmxpbmUgKz0gJzsgdmlzaWJpbGl0eTogdmlzaWJsZTsgJ1xuXG4gICAgICAvLyBncmFiIHRoZSBlbGVtZW50cyBleGlzdGluZyBvcGFjaXR5LlxuICAgICAgZWxlbS5zdHlsZXMuY29tcHV0ZWQub3BhY2l0eSA9IGNvbXB1dGVkLm9wYWNpdHlcblxuICAgICAgLy8gZ3JhYiB0aGUgZWxlbWVudHMgZXhpc3RpbmcgdHJhbnNpdGlvbnMuXG4gICAgICBpZiAoIWNvbXB1dGVkLnRyYW5zaXRpb24gfHwgY29tcHV0ZWQudHJhbnNpdGlvbiA9PT0gJ2FsbCAwcyBlYXNlIDBzJykge1xuICAgICAgICBlbGVtLnN0eWxlcy5jb21wdXRlZC50cmFuc2l0aW9uID0gJydcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW0uc3R5bGVzLmNvbXB1dGVkLnRyYW5zaXRpb24gPSBjb21wdXRlZC50cmFuc2l0aW9uICsgJywgJ1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSB0cmFuc2l0aW9uIHN0eWxlc1xuICAgIGVsZW0uc3R5bGVzLnRyYW5zaXRpb24uaW5zdGFudCA9IF9nZW5lcmF0ZVRyYW5zaXRpb24oZWxlbSwgMClcbiAgICBlbGVtLnN0eWxlcy50cmFuc2l0aW9uLmRlbGF5ZWQgPSBfZ2VuZXJhdGVUcmFuc2l0aW9uKGVsZW0sIGVsZW0uY29uZmlnLmRlbGF5KVxuXG4gICAgLy8gR2VuZXJhdGUgdHJhbnNmb3JtIHN0eWxlcywgZmlyc3Qgd2l0aCB0aGUgd2Via2l0IHByZWZpeC5cbiAgICBlbGVtLnN0eWxlcy50cmFuc2Zvcm0uaW5pdGlhbCA9ICcgLXdlYmtpdC10cmFuc2Zvcm06J1xuICAgIGVsZW0uc3R5bGVzLnRyYW5zZm9ybS50YXJnZXQgPSAnIC13ZWJraXQtdHJhbnNmb3JtOidcbiAgICBfZ2VuZXJhdGVUcmFuc2Zvcm0oZWxlbSlcblxuICAgIC8vIEFuZCBhZ2FpbiB3aXRob3V0IGFueSBwcmVmaXguXG4gICAgZWxlbS5zdHlsZXMudHJhbnNmb3JtLmluaXRpYWwgKz0gJ3RyYW5zZm9ybTonXG4gICAgZWxlbS5zdHlsZXMudHJhbnNmb3JtLnRhcmdldCArPSAndHJhbnNmb3JtOidcbiAgICBfZ2VuZXJhdGVUcmFuc2Zvcm0oZWxlbSlcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZW5lcmF0ZVRyYW5zaXRpb24gKGVsZW0sIGRlbGF5KSB7XG4gICAgdmFyIGNvbmZpZyA9IGVsZW0uY29uZmlnXG5cbiAgICByZXR1cm4gJy13ZWJraXQtdHJhbnNpdGlvbjogJyArIGVsZW0uc3R5bGVzLmNvbXB1dGVkLnRyYW5zaXRpb24gK1xuICAgICAgJy13ZWJraXQtdHJhbnNmb3JtICcgKyBjb25maWcuZHVyYXRpb24gLyAxMDAwICsgJ3MgJyArXG4gICAgICBjb25maWcuZWFzaW5nICsgJyAnICtcbiAgICAgIGRlbGF5IC8gMTAwMCArICdzLCBvcGFjaXR5ICcgK1xuICAgICAgY29uZmlnLmR1cmF0aW9uIC8gMTAwMCArICdzICcgK1xuICAgICAgY29uZmlnLmVhc2luZyArICcgJyArXG4gICAgICBkZWxheSAvIDEwMDAgKyAnczsgJyArXG5cbiAgICAgICd0cmFuc2l0aW9uOiAnICsgZWxlbS5zdHlsZXMuY29tcHV0ZWQudHJhbnNpdGlvbiArXG4gICAgICAndHJhbnNmb3JtICcgKyBjb25maWcuZHVyYXRpb24gLyAxMDAwICsgJ3MgJyArXG4gICAgICBjb25maWcuZWFzaW5nICsgJyAnICtcbiAgICAgIGRlbGF5IC8gMTAwMCArICdzLCBvcGFjaXR5ICcgK1xuICAgICAgY29uZmlnLmR1cmF0aW9uIC8gMTAwMCArICdzICcgK1xuICAgICAgY29uZmlnLmVhc2luZyArICcgJyArXG4gICAgICBkZWxheSAvIDEwMDAgKyAnczsgJ1xuICB9XG5cbiAgZnVuY3Rpb24gX2dlbmVyYXRlVHJhbnNmb3JtIChlbGVtKSB7XG4gICAgdmFyIGNvbmZpZyA9IGVsZW0uY29uZmlnXG4gICAgdmFyIGNzc0Rpc3RhbmNlXG4gICAgdmFyIHRyYW5zZm9ybSA9IGVsZW0uc3R5bGVzLnRyYW5zZm9ybVxuXG4gICAgLy8gTGV04oCZcyBtYWtlIHN1cmUgb3VyIG91ciBwaXhlbCBkaXN0YW5jZXMgYXJlIG5lZ2F0aXZlIGZvciB0b3AgYW5kIGxlZnQuXG4gICAgLy8gZS5nLiBvcmlnaW4gPSAndG9wJyBhbmQgZGlzdGFuY2UgPSAnMjVweCcgc3RhcnRzIGF0IGB0b3A6IC0yNXB4YCBpbiBDU1MuXG4gICAgaWYgKGNvbmZpZy5vcmlnaW4gPT09ICd0b3AnIHx8IGNvbmZpZy5vcmlnaW4gPT09ICdsZWZ0Jykge1xuICAgICAgY3NzRGlzdGFuY2UgPSAvXi0vLnRlc3QoY29uZmlnLmRpc3RhbmNlKVxuICAgICAgICA/IGNvbmZpZy5kaXN0YW5jZS5zdWJzdHIoMSlcbiAgICAgICAgOiAnLScgKyBjb25maWcuZGlzdGFuY2VcbiAgICB9IGVsc2Uge1xuICAgICAgY3NzRGlzdGFuY2UgPSBjb25maWcuZGlzdGFuY2VcbiAgICB9XG5cbiAgICBpZiAocGFyc2VJbnQoY29uZmlnLmRpc3RhbmNlKSkge1xuICAgICAgdHJhbnNmb3JtLmluaXRpYWwgKz0gJyB0cmFuc2xhdGUnICsgY29uZmlnLmF4aXMgKyAnKCcgKyBjc3NEaXN0YW5jZSArICcpJ1xuICAgICAgdHJhbnNmb3JtLnRhcmdldCArPSAnIHRyYW5zbGF0ZScgKyBjb25maWcuYXhpcyArICcoMCknXG4gICAgfVxuICAgIGlmIChjb25maWcuc2NhbGUpIHtcbiAgICAgIHRyYW5zZm9ybS5pbml0aWFsICs9ICcgc2NhbGUoJyArIGNvbmZpZy5zY2FsZSArICcpJ1xuICAgICAgdHJhbnNmb3JtLnRhcmdldCArPSAnIHNjYWxlKDEpJ1xuICAgIH1cbiAgICBpZiAoY29uZmlnLnJvdGF0ZS54KSB7XG4gICAgICB0cmFuc2Zvcm0uaW5pdGlhbCArPSAnIHJvdGF0ZVgoJyArIGNvbmZpZy5yb3RhdGUueCArICdkZWcpJ1xuICAgICAgdHJhbnNmb3JtLnRhcmdldCArPSAnIHJvdGF0ZVgoMCknXG4gICAgfVxuICAgIGlmIChjb25maWcucm90YXRlLnkpIHtcbiAgICAgIHRyYW5zZm9ybS5pbml0aWFsICs9ICcgcm90YXRlWSgnICsgY29uZmlnLnJvdGF0ZS55ICsgJ2RlZyknXG4gICAgICB0cmFuc2Zvcm0udGFyZ2V0ICs9ICcgcm90YXRlWSgwKSdcbiAgICB9XG4gICAgaWYgKGNvbmZpZy5yb3RhdGUueikge1xuICAgICAgdHJhbnNmb3JtLmluaXRpYWwgKz0gJyByb3RhdGVaKCcgKyBjb25maWcucm90YXRlLnogKyAnZGVnKSdcbiAgICAgIHRyYW5zZm9ybS50YXJnZXQgKz0gJyByb3RhdGVaKDApJ1xuICAgIH1cbiAgICB0cmFuc2Zvcm0uaW5pdGlhbCArPSAnOyBvcGFjaXR5OiAnICsgY29uZmlnLm9wYWNpdHkgKyAnOydcbiAgICB0cmFuc2Zvcm0udGFyZ2V0ICs9ICc7IG9wYWNpdHk6ICcgKyBlbGVtLnN0eWxlcy5jb21wdXRlZC5vcGFjaXR5ICsgJzsnXG4gIH1cblxuICBmdW5jdGlvbiBfdXBkYXRlU3RvcmUgKGVsZW0pIHtcbiAgICB2YXIgY29udGFpbmVyID0gZWxlbS5jb25maWcuY29udGFpbmVyXG5cbiAgICAvLyBJZiB0aGlzIGVsZW1lbnTigJlzIGNvbnRhaW5lciBpc27igJl0IGFscmVhZHkgaW4gdGhlIHN0b3JlLCBsZXTigJlzIGFkZCBpdC5cbiAgICBpZiAoY29udGFpbmVyICYmIHNyLnN0b3JlLmNvbnRhaW5lcnMuaW5kZXhPZihjb250YWluZXIpID09PSAtMSkge1xuICAgICAgc3Iuc3RvcmUuY29udGFpbmVycy5wdXNoKGVsZW0uY29uZmlnLmNvbnRhaW5lcilcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgdGhlIGVsZW1lbnQgc3RvcmVkIHdpdGggb3VyIG5ldyBlbGVtZW50LlxuICAgIHNyLnN0b3JlLmVsZW1lbnRzW2VsZW0uaWRdID0gZWxlbVxuICB9XG5cbiAgZnVuY3Rpb24gX3JlY29yZCAodGFyZ2V0LCBjb25maWcsIGludGVydmFsKSB7XG4gICAgLy8gU2F2ZSB0aGUgYHJldmVhbCgpYCBhcmd1bWVudHMgdGhhdCB0cmlnZ2VyZWQgdGhpcyBgX3JlY29yZCgpYCBjYWxsLCBzbyB3ZVxuICAgIC8vIGNhbiByZS10cmFjZSBvdXIgc3RlcHMgd2hlbiBjYWxsaW5nIHRoZSBgc3luYygpYCBtZXRob2QuXG4gICAgdmFyIHJlY29yZCA9IHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgY29uZmlnOiBjb25maWcsXG4gICAgICBpbnRlcnZhbDogaW50ZXJ2YWxcbiAgICB9XG4gICAgc3IuaGlzdG9yeS5wdXNoKHJlY29yZClcbiAgfVxuXG4gIGZ1bmN0aW9uIF9pbml0ICgpIHtcbiAgICBpZiAoc3IuaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgLy8gSW5pdGlhbCBhbmltYXRlIGNhbGwgdHJpZ2dlcnMgdmFsaWQgcmV2ZWFsIGFuaW1hdGlvbnMgb24gZmlyc3QgbG9hZC5cbiAgICAgIC8vIFN1YnNlcXVlbnQgYW5pbWF0ZSBjYWxscyBhcmUgbWFkZSBpbnNpZGUgdGhlIGV2ZW50IGhhbmRsZXIuXG4gICAgICBfYW5pbWF0ZSgpXG5cbiAgICAgIC8vIFRoZW4gd2UgbG9vcCB0aHJvdWdoIGFsbCBjb250YWluZXIgbm9kZXMgaW4gdGhlIHN0b3JlIGFuZCBiaW5kIGV2ZW50XG4gICAgICAvLyBsaXN0ZW5lcnMgdG8gZWFjaC5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Iuc3RvcmUuY29udGFpbmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBzci5zdG9yZS5jb250YWluZXJzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIF9oYW5kbGVyKVxuICAgICAgICBzci5zdG9yZS5jb250YWluZXJzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIF9oYW5kbGVyKVxuICAgICAgfVxuXG4gICAgICAvLyBMZXTigJlzIGFsc28gZG8gYSBvbmUtdGltZSBiaW5kaW5nIG9mIHdpbmRvdyBldmVudCBsaXN0ZW5lcnMuXG4gICAgICBpZiAoIXNyLmluaXRpYWxpemVkKSB7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBfaGFuZGxlcilcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIF9oYW5kbGVyKVxuICAgICAgICBzci5pbml0aWFsaXplZCA9IHRydWVcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNyXG4gIH1cblxuICBmdW5jdGlvbiBfaGFuZGxlciAoKSB7XG4gICAgX3JlcXVlc3RBbmltYXRpb25GcmFtZShfYW5pbWF0ZSlcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zZXRBY3RpdmVTZXF1ZW5jZXMgKCkge1xuICAgIHZhciBhY3RpdmVcbiAgICB2YXIgZWxlbVxuICAgIHZhciBlbGVtSWRcbiAgICB2YXIgc2VxdWVuY2VcblxuICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgc2VxdWVuY2VzXG4gICAgc3IudG9vbHMuZm9yT3duKHNyLnNlcXVlbmNlcywgZnVuY3Rpb24gKHNlcXVlbmNlSWQpIHtcbiAgICAgIHNlcXVlbmNlID0gc3Iuc2VxdWVuY2VzW3NlcXVlbmNlSWRdXG4gICAgICBhY3RpdmUgPSBmYWxzZVxuXG4gICAgICAvLyBGb3IgZWFjaCBzZXF1ZW5jZWQgZWxlbWVuZXQsIGxldOKAmXMgY2hlY2sgdmlzaWJpbGl0eSBhbmQgaWZcbiAgICAgIC8vIGFueSBhcmUgdmlzaWJsZSwgc2V0IGl04oCZcyBzZXF1ZW5jZSB0byBhY3RpdmUuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlcXVlbmNlLmVsZW1JZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZWxlbUlkID0gc2VxdWVuY2UuZWxlbUlkc1tpXVxuICAgICAgICBlbGVtID0gc3Iuc3RvcmUuZWxlbWVudHNbZWxlbUlkXVxuICAgICAgICBpZiAoX2lzRWxlbVZpc2libGUoZWxlbSkgJiYgIWFjdGl2ZSkge1xuICAgICAgICAgIGFjdGl2ZSA9IHRydWVcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBzZXF1ZW5jZS5hY3RpdmUgPSBhY3RpdmVcbiAgICB9KVxuICB9XG5cbiAgZnVuY3Rpb24gX2FuaW1hdGUgKCkge1xuICAgIHZhciBkZWxheWVkXG4gICAgdmFyIGVsZW1cblxuICAgIF9zZXRBY3RpdmVTZXF1ZW5jZXMoKVxuXG4gICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBlbGVtZW50cyBpbiB0aGUgc3RvcmVcbiAgICBzci50b29scy5mb3JPd24oc3Iuc3RvcmUuZWxlbWVudHMsIGZ1bmN0aW9uIChlbGVtSWQpIHtcbiAgICAgIGVsZW0gPSBzci5zdG9yZS5lbGVtZW50c1tlbGVtSWRdXG4gICAgICBkZWxheWVkID0gX3Nob3VsZFVzZURlbGF5KGVsZW0pXG5cbiAgICAgIC8vIExldOKAmXMgc2VlIGlmIHdlIHNob3VsZCByZXZlYWxhbmQgaWYgc28sXG4gICAgICAvLyB0cmlnZ2VyIHRoZSBgYmVmb3JlUmV2ZWFsYCBjYWxsYmFjayBhbmRcbiAgICAgIC8vIGRldGVybWluZSB3aGV0aGVyIG9yIG5vdCB0byB1c2UgZGVsYXkuXG4gICAgICBpZiAoX3Nob3VsZFJldmVhbChlbGVtKSkge1xuICAgICAgICBlbGVtLmNvbmZpZy5iZWZvcmVSZXZlYWwoZWxlbS5kb21FbClcbiAgICAgICAgaWYgKGRlbGF5ZWQpIHtcbiAgICAgICAgICBlbGVtLmRvbUVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLFxuICAgICAgICAgICAgZWxlbS5zdHlsZXMuaW5saW5lICtcbiAgICAgICAgICAgIGVsZW0uc3R5bGVzLnRyYW5zZm9ybS50YXJnZXQgK1xuICAgICAgICAgICAgZWxlbS5zdHlsZXMudHJhbnNpdGlvbi5kZWxheWVkXG4gICAgICAgICAgKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsZW0uZG9tRWwuc2V0QXR0cmlidXRlKCdzdHlsZScsXG4gICAgICAgICAgICBlbGVtLnN0eWxlcy5pbmxpbmUgK1xuICAgICAgICAgICAgZWxlbS5zdHlsZXMudHJhbnNmb3JtLnRhcmdldCArXG4gICAgICAgICAgICBlbGVtLnN0eWxlcy50cmFuc2l0aW9uLmluc3RhbnRcbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICAvLyBMZXTigJlzIHF1ZXVlIHRoZSBgYWZ0ZXJSZXZlYWxgIGNhbGxiYWNrXG4gICAgICAgIC8vIGFuZCBtYXJrIHRoZSBlbGVtZW50IGFzIHNlZW4gYW5kIHJldmVhbGluZy5cbiAgICAgICAgX3F1ZXVlQ2FsbGJhY2soJ3JldmVhbCcsIGVsZW0sIGRlbGF5ZWQpXG4gICAgICAgIGVsZW0ucmV2ZWFsaW5nID0gdHJ1ZVxuICAgICAgICBlbGVtLnNlZW4gPSB0cnVlXG5cbiAgICAgICAgaWYgKGVsZW0uc2VxdWVuY2UpIHtcbiAgICAgICAgICBfcXVldWVOZXh0SW5TZXF1ZW5jZShlbGVtLCBkZWxheWVkKVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKF9zaG91bGRSZXNldChlbGVtKSkge1xuICAgICAgICAvL090aGVyd2lzZSByZXNldCBvdXIgZWxlbWVudCBhbmRcbiAgICAgICAgLy8gdHJpZ2dlciB0aGUgYGJlZm9yZVJlc2V0YCBjYWxsYmFjay5cbiAgICAgICAgZWxlbS5jb25maWcuYmVmb3JlUmVzZXQoZWxlbS5kb21FbClcbiAgICAgICAgZWxlbS5kb21FbC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJyxcbiAgICAgICAgICBlbGVtLnN0eWxlcy5pbmxpbmUgK1xuICAgICAgICAgIGVsZW0uc3R5bGVzLnRyYW5zZm9ybS5pbml0aWFsICtcbiAgICAgICAgICBlbGVtLnN0eWxlcy50cmFuc2l0aW9uLmluc3RhbnRcbiAgICAgICAgKVxuICAgICAgICAvLyBBbmQgcXVldWUgdGhlIGBhZnRlclJlc2V0YCBjYWxsYmFjay5cbiAgICAgICAgX3F1ZXVlQ2FsbGJhY2soJ3Jlc2V0JywgZWxlbSlcbiAgICAgICAgZWxlbS5yZXZlYWxpbmcgPSBmYWxzZVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBmdW5jdGlvbiBfcXVldWVOZXh0SW5TZXF1ZW5jZSAoZWxlbSwgZGVsYXllZCkge1xuICAgIHZhciBlbGFwc2VkID0gMFxuICAgIHZhciBkZWxheSA9IDBcbiAgICB2YXIgc2VxdWVuY2UgPSBzci5zZXF1ZW5jZXNbZWxlbS5zZXF1ZW5jZS5pZF1cblxuICAgIC8vIFdl4oCZcmUgcHJvY2Vzc2luZyBhIHNlcXVlbmNlZCBlbGVtZW50LCBzbyBsZXQncyBibG9jayBvdGhlciBlbGVtZW50cyBpbiB0aGlzIHNlcXVlbmNlLlxuICAgIHNlcXVlbmNlLmJsb2NrZWQgPSB0cnVlXG5cbiAgICAvLyBTaW5jZSB3ZeKAmXJlIHRyaWdnZXJpbmcgYW5pbWF0aW9ucyBhIHBhcnQgb2YgYSBzZXF1ZW5jZSBhZnRlciBhbmltYXRpb25zIG9uIGZpcnN0IGxvYWQsXG4gICAgLy8gd2UgbmVlZCB0byBjaGVjayBmb3IgdGhhdCBjb25kaXRpb24gYW5kIGV4cGxpY2l0bHkgYWRkIHRoZSBkZWxheSB0byBvdXIgdGltZXIuXG4gICAgaWYgKGRlbGF5ZWQgJiYgZWxlbS5jb25maWcudXNlRGVsYXkgPT09ICdvbmxvYWQnKSB7XG4gICAgICBkZWxheSA9IGVsZW0uY29uZmlnLmRlbGF5XG4gICAgfVxuXG4gICAgLy8gSWYgYSBzZXF1ZW5jZSB0aW1lciBpcyBhbHJlYWR5IHJ1bm5pbmcsIGNhcHR1cmUgdGhlIGVsYXBzZWQgdGltZSBhbmQgY2xlYXIgaXQuXG4gICAgaWYgKGVsZW0uc2VxdWVuY2UudGltZXIpIHtcbiAgICAgIGVsYXBzZWQgPSBNYXRoLmFicyhlbGVtLnNlcXVlbmNlLnRpbWVyLnN0YXJ0ZWQgLSBuZXcgRGF0ZSgpKVxuICAgICAgd2luZG93LmNsZWFyVGltZW91dChlbGVtLnNlcXVlbmNlLnRpbWVyKVxuICAgIH1cblxuICAgIC8vIFN0YXJ0IGEgbmV3IHRpbWVyLlxuICAgIGVsZW0uc2VxdWVuY2UudGltZXIgPSB7IHN0YXJ0ZWQ6IG5ldyBEYXRlKCkgfVxuICAgIGVsZW0uc2VxdWVuY2UudGltZXIuY2xvY2sgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBTZXF1ZW5jZSBpbnRlcnZhbCBoYXMgcGFzc2VkLCBzbyB1bmJsb2NrIHRoZSBzZXF1ZW5jZSBhbmQgcmUtcnVuIHRoZSBoYW5kbGVyLlxuICAgICAgc2VxdWVuY2UuYmxvY2tlZCA9IGZhbHNlXG4gICAgICBlbGVtLnNlcXVlbmNlLnRpbWVyID0gbnVsbFxuICAgICAgX2hhbmRsZXIoKVxuICAgIH0sIE1hdGguYWJzKHNlcXVlbmNlLmludGVydmFsKSArIGRlbGF5IC0gZWxhcHNlZClcbiAgfVxuXG4gIGZ1bmN0aW9uIF9xdWV1ZUNhbGxiYWNrICh0eXBlLCBlbGVtLCBkZWxheWVkKSB7XG4gICAgdmFyIGVsYXBzZWQgPSAwXG4gICAgdmFyIGR1cmF0aW9uID0gMFxuICAgIHZhciBjYWxsYmFjayA9ICdhZnRlcidcblxuICAgIC8vIENoZWNrIHdoaWNoIGNhbGxiYWNrIHdl4oCZcmUgd29ya2luZyB3aXRoLlxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAncmV2ZWFsJzpcbiAgICAgICAgZHVyYXRpb24gPSBlbGVtLmNvbmZpZy5kdXJhdGlvblxuICAgICAgICBpZiAoZGVsYXllZCkge1xuICAgICAgICAgIGR1cmF0aW9uICs9IGVsZW0uY29uZmlnLmRlbGF5XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2sgKz0gJ1JldmVhbCdcbiAgICAgICAgYnJlYWtcblxuICAgICAgY2FzZSAncmVzZXQnOlxuICAgICAgICBkdXJhdGlvbiA9IGVsZW0uY29uZmlnLmR1cmF0aW9uXG4gICAgICAgIGNhbGxiYWNrICs9ICdSZXNldCdcbiAgICAgICAgYnJlYWtcbiAgICB9XG5cbiAgICAvLyBJZiBhIHRpbWVyIGlzIGFscmVhZHkgcnVubmluZywgY2FwdHVyZSB0aGUgZWxhcHNlZCB0aW1lIGFuZCBjbGVhciBpdC5cbiAgICBpZiAoZWxlbS50aW1lcikge1xuICAgICAgZWxhcHNlZCA9IE1hdGguYWJzKGVsZW0udGltZXIuc3RhcnRlZCAtIG5ldyBEYXRlKCkpXG4gICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KGVsZW0udGltZXIuY2xvY2spXG4gICAgfVxuXG4gICAgLy8gU3RhcnQgYSBuZXcgdGltZXIuXG4gICAgZWxlbS50aW1lciA9IHsgc3RhcnRlZDogbmV3IERhdGUoKSB9XG4gICAgZWxlbS50aW1lci5jbG9jayA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIFRoZSB0aW1lciBjb21wbGV0ZWQsIHNvIGxldOKAmXMgZmlyZSB0aGUgY2FsbGJhY2sgYW5kIG51bGwgdGhlIHRpbWVyLlxuICAgICAgZWxlbS5jb25maWdbY2FsbGJhY2tdKGVsZW0uZG9tRWwpXG4gICAgICBlbGVtLnRpbWVyID0gbnVsbFxuICAgIH0sIGR1cmF0aW9uIC0gZWxhcHNlZClcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zaG91bGRSZXZlYWwgKGVsZW0pIHtcbiAgICBpZiAoZWxlbS5zZXF1ZW5jZSkge1xuICAgICAgdmFyIHNlcXVlbmNlID0gc3Iuc2VxdWVuY2VzW2VsZW0uc2VxdWVuY2UuaWRdXG4gICAgICByZXR1cm4gc2VxdWVuY2UuYWN0aXZlICYmXG4gICAgICAgICFzZXF1ZW5jZS5ibG9ja2VkICYmXG4gICAgICAgICFlbGVtLnJldmVhbGluZyAmJlxuICAgICAgICAhZWxlbS5kaXNhYmxlZFxuICAgIH1cbiAgICByZXR1cm4gX2lzRWxlbVZpc2libGUoZWxlbSkgJiZcbiAgICAgICFlbGVtLnJldmVhbGluZyAmJlxuICAgICAgIWVsZW0uZGlzYWJsZWRcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zaG91bGRVc2VEZWxheSAoZWxlbSkge1xuICAgIHZhciBjb25maWcgPSBlbGVtLmNvbmZpZy51c2VEZWxheVxuICAgIHJldHVybiBjb25maWcgPT09ICdhbHdheXMnIHx8XG4gICAgICAoY29uZmlnID09PSAnb25sb2FkJyAmJiAhc3IuaW5pdGlhbGl6ZWQpIHx8XG4gICAgICAoY29uZmlnID09PSAnb25jZScgJiYgIWVsZW0uc2VlbilcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zaG91bGRSZXNldCAoZWxlbSkge1xuICAgIGlmIChlbGVtLnNlcXVlbmNlKSB7XG4gICAgICB2YXIgc2VxdWVuY2UgPSBzci5zZXF1ZW5jZXNbZWxlbS5zZXF1ZW5jZS5pZF1cbiAgICAgIHJldHVybiAhc2VxdWVuY2UuYWN0aXZlICYmXG4gICAgICAgIGVsZW0uY29uZmlnLnJlc2V0ICYmXG4gICAgICAgIGVsZW0ucmV2ZWFsaW5nICYmXG4gICAgICAgICFlbGVtLmRpc2FibGVkXG4gICAgfVxuICAgIHJldHVybiAhX2lzRWxlbVZpc2libGUoZWxlbSkgJiZcbiAgICAgIGVsZW0uY29uZmlnLnJlc2V0ICYmXG4gICAgICBlbGVtLnJldmVhbGluZyAmJlxuICAgICAgIWVsZW0uZGlzYWJsZWRcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRDb250YWluZXIgKGNvbnRhaW5lcikge1xuICAgIHJldHVybiB7XG4gICAgICB3aWR0aDogY29udGFpbmVyLmNsaWVudFdpZHRoLFxuICAgICAgaGVpZ2h0OiBjb250YWluZXIuY2xpZW50SGVpZ2h0XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2dldFNjcm9sbGVkIChjb250YWluZXIpIHtcbiAgICAvLyBSZXR1cm4gdGhlIGNvbnRhaW5lciBzY3JvbGwgdmFsdWVzLCBwbHVzIHRoZSBpdHMgb2Zmc2V0LlxuICAgIGlmIChjb250YWluZXIgJiYgY29udGFpbmVyICE9PSB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgICB2YXIgb2Zmc2V0ID0gX2dldE9mZnNldChjb250YWluZXIpXG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiBjb250YWluZXIuc2Nyb2xsTGVmdCArIG9mZnNldC5sZWZ0LFxuICAgICAgICB5OiBjb250YWluZXIuc2Nyb2xsVG9wICsgb2Zmc2V0LnRvcFxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBPdGhlcndpc2UsIGRlZmF1bHQgdG8gdGhlIHdpbmRvdyBvYmplY3TigJlzIHNjcm9sbCB2YWx1ZXMuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiB3aW5kb3cucGFnZVhPZmZzZXQsXG4gICAgICAgIHk6IHdpbmRvdy5wYWdlWU9mZnNldFxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRPZmZzZXQgKGRvbUVsKSB7XG4gICAgdmFyIG9mZnNldFRvcCA9IDBcbiAgICB2YXIgb2Zmc2V0TGVmdCA9IDBcblxuICAgICAgLy8gR3JhYiB0aGUgZWxlbWVudOKAmXMgZGltZW5zaW9ucy5cbiAgICB2YXIgb2Zmc2V0SGVpZ2h0ID0gZG9tRWwub2Zmc2V0SGVpZ2h0XG4gICAgdmFyIG9mZnNldFdpZHRoID0gZG9tRWwub2Zmc2V0V2lkdGhcblxuICAgIC8vIE5vdyBjYWxjdWxhdGUgdGhlIGRpc3RhbmNlIGJldHdlZW4gdGhlIGVsZW1lbnQgYW5kIGl0cyBwYXJlbnQsIHRoZW5cbiAgICAvLyBhZ2FpbiBmb3IgdGhlIHBhcmVudCB0byBpdHMgcGFyZW50LCBhbmQgYWdhaW4gZXRjLi4uIHVudGlsIHdlIGhhdmUgdGhlXG4gICAgLy8gdG90YWwgZGlzdGFuY2Ugb2YgdGhlIGVsZW1lbnQgdG8gdGhlIGRvY3VtZW504oCZcyB0b3AgYW5kIGxlZnQgb3JpZ2luLlxuICAgIGRvIHtcbiAgICAgIGlmICghaXNOYU4oZG9tRWwub2Zmc2V0VG9wKSkge1xuICAgICAgICBvZmZzZXRUb3AgKz0gZG9tRWwub2Zmc2V0VG9wXG4gICAgICB9XG4gICAgICBpZiAoIWlzTmFOKGRvbUVsLm9mZnNldExlZnQpKSB7XG4gICAgICAgIG9mZnNldExlZnQgKz0gZG9tRWwub2Zmc2V0TGVmdFxuICAgICAgfVxuICAgICAgZG9tRWwgPSBkb21FbC5vZmZzZXRQYXJlbnRcbiAgICB9IHdoaWxlIChkb21FbClcblxuICAgIHJldHVybiB7XG4gICAgICB0b3A6IG9mZnNldFRvcCxcbiAgICAgIGxlZnQ6IG9mZnNldExlZnQsXG4gICAgICBoZWlnaHQ6IG9mZnNldEhlaWdodCxcbiAgICAgIHdpZHRoOiBvZmZzZXRXaWR0aFxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9pc0VsZW1WaXNpYmxlIChlbGVtKSB7XG4gICAgdmFyIG9mZnNldCA9IF9nZXRPZmZzZXQoZWxlbS5kb21FbClcbiAgICB2YXIgY29udGFpbmVyID0gX2dldENvbnRhaW5lcihlbGVtLmNvbmZpZy5jb250YWluZXIpXG4gICAgdmFyIHNjcm9sbGVkID0gX2dldFNjcm9sbGVkKGVsZW0uY29uZmlnLmNvbnRhaW5lcilcbiAgICB2YXIgdkYgPSBlbGVtLmNvbmZpZy52aWV3RmFjdG9yXG5cbiAgICAgIC8vIERlZmluZSB0aGUgZWxlbWVudCBnZW9tZXRyeS5cbiAgICB2YXIgZWxlbUhlaWdodCA9IG9mZnNldC5oZWlnaHRcbiAgICB2YXIgZWxlbVdpZHRoID0gb2Zmc2V0LndpZHRoXG4gICAgdmFyIGVsZW1Ub3AgPSBvZmZzZXQudG9wXG4gICAgdmFyIGVsZW1MZWZ0ID0gb2Zmc2V0LmxlZnRcbiAgICB2YXIgZWxlbUJvdHRvbSA9IGVsZW1Ub3AgKyBlbGVtSGVpZ2h0XG4gICAgdmFyIGVsZW1SaWdodCA9IGVsZW1MZWZ0ICsgZWxlbVdpZHRoXG5cbiAgICByZXR1cm4gY29uZmlybUJvdW5kcygpIHx8IGlzUG9zaXRpb25GaXhlZCgpXG5cbiAgICBmdW5jdGlvbiBjb25maXJtQm91bmRzICgpIHtcbiAgICAgIC8vIERlZmluZSB0aGUgZWxlbWVudOKAmXMgZnVuY3Rpb25hbCBib3VuZGFyaWVzIHVzaW5nIGl0cyB2aWV3IGZhY3Rvci5cbiAgICAgIHZhciB0b3AgPSBlbGVtVG9wICsgZWxlbUhlaWdodCAqIHZGXG4gICAgICB2YXIgbGVmdCA9IGVsZW1MZWZ0ICsgZWxlbVdpZHRoICogdkZcbiAgICAgIHZhciBib3R0b20gPSBlbGVtQm90dG9tIC0gZWxlbUhlaWdodCAqIHZGXG4gICAgICB2YXIgcmlnaHQgPSBlbGVtUmlnaHQgLSBlbGVtV2lkdGggKiB2RlxuXG4gICAgICAvLyBEZWZpbmUgdGhlIGNvbnRhaW5lciBmdW5jdGlvbmFsIGJvdW5kYXJpZXMgdXNpbmcgaXRzIHZpZXcgb2Zmc2V0LlxuICAgICAgdmFyIHZpZXdUb3AgPSBzY3JvbGxlZC55ICsgZWxlbS5jb25maWcudmlld09mZnNldC50b3BcbiAgICAgIHZhciB2aWV3TGVmdCA9IHNjcm9sbGVkLnggKyBlbGVtLmNvbmZpZy52aWV3T2Zmc2V0LmxlZnRcbiAgICAgIHZhciB2aWV3Qm90dG9tID0gc2Nyb2xsZWQueSAtIGVsZW0uY29uZmlnLnZpZXdPZmZzZXQuYm90dG9tICsgY29udGFpbmVyLmhlaWdodFxuICAgICAgdmFyIHZpZXdSaWdodCA9IHNjcm9sbGVkLnggLSBlbGVtLmNvbmZpZy52aWV3T2Zmc2V0LnJpZ2h0ICsgY29udGFpbmVyLndpZHRoXG5cbiAgICAgIHJldHVybiB0b3AgPCB2aWV3Qm90dG9tICYmXG4gICAgICAgIGJvdHRvbSA+IHZpZXdUb3AgJiZcbiAgICAgICAgbGVmdCA8IHZpZXdSaWdodCAmJlxuICAgICAgICByaWdodCA+IHZpZXdMZWZ0XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNQb3NpdGlvbkZpeGVkICgpIHtcbiAgICAgIHJldHVybiAod2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbS5kb21FbCkucG9zaXRpb24gPT09ICdmaXhlZCcpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFV0aWxpdGllc1xuICAgKiAtLS0tLS0tLS1cbiAgICovXG5cbiAgZnVuY3Rpb24gVG9vbHMgKCkge31cblxuICBUb29scy5wcm90b3R5cGUuaXNPYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgcmV0dXJuIG9iamVjdCAhPT0gbnVsbCAmJiB0eXBlb2Ygb2JqZWN0ID09PSAnb2JqZWN0JyAmJiBvYmplY3QuY29uc3RydWN0b3IgPT09IE9iamVjdFxuICB9XG5cbiAgVG9vbHMucHJvdG90eXBlLmlzTm9kZSA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gdHlwZW9mIHdpbmRvdy5Ob2RlID09PSAnb2JqZWN0J1xuICAgICAgPyBvYmplY3QgaW5zdGFuY2VvZiB3aW5kb3cuTm9kZVxuICAgICAgOiBvYmplY3QgJiYgdHlwZW9mIG9iamVjdCA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgdHlwZW9mIG9iamVjdC5ub2RlVHlwZSA9PT0gJ251bWJlcicgJiZcbiAgICAgICAgdHlwZW9mIG9iamVjdC5ub2RlTmFtZSA9PT0gJ3N0cmluZydcbiAgfVxuXG4gIFRvb2xzLnByb3RvdHlwZS5pc05vZGVMaXN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHZhciBwcm90b3R5cGVUb1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmplY3QpXG4gICAgdmFyIHJlZ2V4ID0gL15cXFtvYmplY3QgKEhUTUxDb2xsZWN0aW9ufE5vZGVMaXN0fE9iamVjdClcXF0kL1xuXG4gICAgcmV0dXJuIHR5cGVvZiB3aW5kb3cuTm9kZUxpc3QgPT09ICdvYmplY3QnXG4gICAgICA/IG9iamVjdCBpbnN0YW5jZW9mIHdpbmRvdy5Ob2RlTGlzdFxuICAgICAgOiBvYmplY3QgJiYgdHlwZW9mIG9iamVjdCA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgcmVnZXgudGVzdChwcm90b3R5cGVUb1N0cmluZykgJiZcbiAgICAgICAgdHlwZW9mIG9iamVjdC5sZW5ndGggPT09ICdudW1iZXInICYmXG4gICAgICAgIChvYmplY3QubGVuZ3RoID09PSAwIHx8IHRoaXMuaXNOb2RlKG9iamVjdFswXSkpXG4gIH1cblxuICBUb29scy5wcm90b3R5cGUuZm9yT3duID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICBpZiAoIXRoaXMuaXNPYmplY3Qob2JqZWN0KSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRXhwZWN0ZWQgXCJvYmplY3RcIiwgYnV0IHJlY2VpdmVkIFwiJyArIHR5cGVvZiBvYmplY3QgKyAnXCIuJylcbiAgICB9IGVsc2Uge1xuICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gb2JqZWN0KSB7XG4gICAgICAgIGlmIChvYmplY3QuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XG4gICAgICAgICAgY2FsbGJhY2socHJvcGVydHkpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBUb29scy5wcm90b3R5cGUuZXh0ZW5kID0gZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7XG4gICAgdGhpcy5mb3JPd24oc291cmNlLCBmdW5jdGlvbiAocHJvcGVydHkpIHtcbiAgICAgIGlmICh0aGlzLmlzT2JqZWN0KHNvdXJjZVtwcm9wZXJ0eV0pKSB7XG4gICAgICAgIGlmICghdGFyZ2V0W3Byb3BlcnR5XSB8fCAhdGhpcy5pc09iamVjdCh0YXJnZXRbcHJvcGVydHldKSkge1xuICAgICAgICAgIHRhcmdldFtwcm9wZXJ0eV0gPSB7fVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZXh0ZW5kKHRhcmdldFtwcm9wZXJ0eV0sIHNvdXJjZVtwcm9wZXJ0eV0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0YXJnZXRbcHJvcGVydHldID0gc291cmNlW3Byb3BlcnR5XVxuICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSlcbiAgICByZXR1cm4gdGFyZ2V0XG4gIH1cblxuICBUb29scy5wcm90b3R5cGUuZXh0ZW5kQ2xvbmUgPSBmdW5jdGlvbiAodGFyZ2V0LCBzb3VyY2UpIHtcbiAgICByZXR1cm4gdGhpcy5leHRlbmQodGhpcy5leHRlbmQoe30sIHRhcmdldCksIHNvdXJjZSlcbiAgfVxuXG4gIFRvb2xzLnByb3RvdHlwZS5pc01vYmlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxCbGFja0JlcnJ5fElFTW9iaWxlfE9wZXJhIE1pbmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpXG4gIH1cblxuICAvKipcbiAgICogUG9seWZpbGxzXG4gICAqIC0tLS0tLS0tXG4gICAqL1xuXG4gIF9yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGNhbGxiYWNrLCAxMDAwIC8gNjApXG4gICAgfVxuXG4gIC8qKlxuICAgKiBNb2R1bGUgV3JhcHBlclxuICAgKiAtLS0tLS0tLS0tLS0tLVxuICAgKi9cbiAgaWYgKHRydWUpIHtcbiAgICAhKF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFNjcm9sbFJldmVhbFxuICAgIH0uY2FsbChleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fLCBleHBvcnRzLCBtb2R1bGUpLFxuXHRcdFx0XHRfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyAhPT0gdW5kZWZpbmVkICYmIChtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fKSlcbiAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gU2Nyb2xsUmV2ZWFsXG4gIH0gZWxzZSB7XG4gICAgd2luZG93LlNjcm9sbFJldmVhbCA9IFNjcm9sbFJldmVhbFxuICB9XG59KSgpO1xuXG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vc3JjL2Fib3V0L2Fib3V0LmpzXCI6XG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KF9fd2VicGFja19leHBvcnRzX18sIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fc2NyaXB0c19zY3JvbGxfXyA9IF9fd2VicGFja19yZXF1aXJlX18oXCIuL3NyYy9zY3JpcHRzL3Njcm9sbC5qc1wiKTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfX3NjcmlwdHNfbmF2T25Nb2JpbGVfXyA9IF9fd2VicGFja19yZXF1aXJlX18oXCIuL3NyYy9zY3JpcHRzL25hdk9uTW9iaWxlLmpzXCIpO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fc3R5bGVzX3VzZXJmZWVkc19zY3NzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKFwiLi9zcmMvc3R5bGVzL3VzZXJmZWVkcy5zY3NzXCIpO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fc3R5bGVzX3VzZXJmZWVkc19zY3NzX19fZGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18ubihfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfX3N0eWxlc191c2VyZmVlZHNfc2Nzc19fKTtcblxuXG5cblxuXG5pZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykge1xuICBpbml0KCk7XG59IGVsc2Uge1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGluaXQpO1xufVxuXG5mdW5jdGlvbiBpbml0KCkge1xuICBPYmplY3QoX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19zY3JpcHRzX3Njcm9sbF9fW1wiYVwiIC8qIGRlZmF1bHQgKi9dKSgpO1xuICBPYmplY3QoX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19zY3JpcHRzX25hdk9uTW9iaWxlX19bXCJhXCIgLyogZGVmYXVsdCAqL10pKCk7XG59XG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vc3JjL3NjcmlwdHMvbmF2T25Nb2JpbGUuanNcIjpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG4vKiBoYXJtb255IGV4cG9ydCAoaW1tdXRhYmxlKSAqLyBfX3dlYnBhY2tfZXhwb3J0c19fW1wiYVwiXSA9IGluaXROYXZPbk1vYmlsZTtcbmZ1bmN0aW9uIGluaXROYXZPbk1vYmlsZSgpIHtcbiAgdmFyICRidXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtbW9iaWxlTWVudScpO1xuXG4gICRidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIHZhciB0YXJnZXQgPSAkYnV0dG9uLmdldEF0dHJpYnV0ZSgnZGF0YS10YXJnZXQnKTtcblxuICAgIGlmICh0YXJnZXQgIT0gdW5kZWZpbmVkICYmIHRhcmdldCAhPSAnJykge1xuICAgICAgJGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldCkuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9zcmMvc2NyaXB0cy9zY3JvbGwuanNcIjpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG4vKiBoYXJtb255IGV4cG9ydCAoaW1tdXRhYmxlKSAqLyBfX3dlYnBhY2tfZXhwb3J0c19fW1wiYVwiXSA9IGluaXRTY3JvbGxSZXZlYWw7XG4vKiBoYXJtb255IGltcG9ydCAqLyB2YXIgX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX3Njcm9sbHJldmVhbF9fID0gX193ZWJwYWNrX3JlcXVpcmVfXyhcIi4vbm9kZV9tb2R1bGVzL3Njcm9sbHJldmVhbC9kaXN0L3Njcm9sbHJldmVhbC5qc1wiKTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfc2Nyb2xscmV2ZWFsX19fZGVmYXVsdCA9IF9fd2VicGFja19yZXF1aXJlX18ubihfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfc2Nyb2xscmV2ZWFsX18pO1xuXG5cbmZ1bmN0aW9uIGluaXRTY3JvbGxSZXZlYWwoKSB7XG4gIHdpbmRvdy5zciA9IF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9zY3JvbGxyZXZlYWxfX19kZWZhdWx0KCkoeyBkdXJhdGlvbjogNzAwLCB2aWV3RmFjdG9yOiAwLjQgfSk7XG5cbiAgaWYgKHNyLmlzU3VwcG9ydGVkKCkpIHtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnc3InKTtcblxuICAgIHNyLnJldmVhbCgnLmFuaW0tZmFkZScsIHsgZGlzdGFuY2U6ICcwcHgnLCBzY2FsZTogMSwgZHVyYXRpb246IDEwMDAwIH0pO1xuICAgIHNyLnJldmVhbCgnLmFuaW0tZmFkZUJvdHRvbScsIHsgb3JpZ2luOiBcImJvdHRvbVwiLCBzY2FsZTogMSwgZGlzdGFuY2U6ICcxMHB4JywgZWFzaW5nOiAnZWFzZS1pbicsIGR1cmF0aW9uOiAzMDAgfSk7XG4gICAgc3IucmV2ZWFsKCcuYW5pbS1mYWRlUmlnaHQnLCB7IG9yaWdpbjogXCJyaWdodFwiIH0pO1xuICAgIHNyLnJldmVhbCgnLmFuaW0tZmFkZUxlZnQnLCB7IG9yaWdpbjogXCJsZWZ0XCIsIHNjYWxlOiAxLCBkaXN0YW5jZTogJzIwcHgnLCBlYXNpbmc6ICdjdWJpYy1iZXppZXIoMC42LCAwLjMsIDAuMSwgMSknIH0pO1xuICAgIHNyLnJldmVhbCgnLmFuaW0tZmFkZVRvcCcsIHsgb3JpZ2luOiBcInRvcFwiIH0pO1xuICAgIHNyLnJldmVhbCgnLmFuaW0tYmFja1RvRnJvbnQnLCB7IHNjYWxlOiAwLjUgfSk7XG4gICAgc3IucmV2ZWFsKCcuYW5pbS1mcm9udFRvQmFjaycsIHsgc2NhbGU6IDEuMiB9KTtcbiAgfSBlbHNlIHtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc3InKTtcbiAgfVxufVxuXG4vKioqLyB9KSxcblxuLyoqKi8gXCIuL3NyYy9zdHlsZXMvdXNlcmZlZWRzLnNjc3NcIjpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuLy8gcmVtb3ZlZCBieSBleHRyYWN0LXRleHQtd2VicGFjay1wbHVnaW5cblxuLyoqKi8gfSlcblxuLyoqKioqKi8gfSk7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIGFib3V0X2Y2ZGE3N2IwMzU1N2U5OTgyNWRlLmpzIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gXCIuL3NyYy9hYm91dC9hYm91dC5qc1wiKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCBmNmRhNzdiMDM1NTdlOTk4MjVkZSIsIi8vLy8vICAgIC8vLy8vICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAvLy8vLyAgICAvLy8vLyAgICAvLy8vL1xuLy8vLy8gICAgLy8vLy8gICAgLy8vLy8gICAgLy8vLy9cbi8vLy8vICAgIC8vLy8vICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAgICAgICAgICAvLy8vLyAgICAvLy8vL1xuLy8vLy8gICAgICAgICAgICAgLy8vLy8gICAgLy8vLy9cbi8vLy8vICAgIC8vLy8vICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAvLy8vLyAgICAvLy8vLyAgICAvLy8vL1xuICAgICAgICAgLy8vLy8gICAgLy8vLy9cbiAgICAgICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAvLy8vLyAgICAvLy8vLyAgICAvLy8vL1xuLy8vLy8gICAgLy8vLy8gICAgLy8vLy8gICAgLy8vLy9cbi8vLy8vICAgIC8vLy8vICAgIC8vLy8vICAgIC8vLy8vXG4vLy8vLyAgICAvLy8vLyAgICAvLy8vLyAgICAvLy8vL1xuXG4vKipcbiAqIFNjcm9sbFJldmVhbFxuICogLS0tLS0tLS0tLS0tXG4gKiBWZXJzaW9uIDogMy4zLjZcbiAqIFdlYnNpdGUgOiBzY3JvbGxyZXZlYWxqcy5vcmdcbiAqIFJlcG8gICAgOiBnaXRodWIuY29tL2psbWFrZXMvc2Nyb2xscmV2ZWFsLmpzXG4gKiBBdXRob3IgIDogSnVsaWFuIExsb3lkIChAamxtYWtlcylcbiAqL1xuXG47KGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnXG5cbiAgdmFyIHNyXG4gIHZhciBfcmVxdWVzdEFuaW1hdGlvbkZyYW1lXG5cbiAgZnVuY3Rpb24gU2Nyb2xsUmV2ZWFsIChjb25maWcpIHtcbiAgICAvLyBTdXBwb3J0IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgYG5ld2Aga2V5d29yZC5cbiAgICBpZiAodHlwZW9mIHRoaXMgPT09ICd1bmRlZmluZWQnIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSAhPT0gU2Nyb2xsUmV2ZWFsLnByb3RvdHlwZSkge1xuICAgICAgcmV0dXJuIG5ldyBTY3JvbGxSZXZlYWwoY29uZmlnKVxuICAgIH1cblxuICAgIHNyID0gdGhpcyAvLyBTYXZlIHJlZmVyZW5jZSB0byBpbnN0YW5jZS5cbiAgICBzci52ZXJzaW9uID0gJzMuMy42J1xuICAgIHNyLnRvb2xzID0gbmV3IFRvb2xzKCkgLy8gKnJlcXVpcmVkIHV0aWxpdGllc1xuXG4gICAgaWYgKHNyLmlzU3VwcG9ydGVkKCkpIHtcbiAgICAgIHNyLnRvb2xzLmV4dGVuZChzci5kZWZhdWx0cywgY29uZmlnIHx8IHt9KVxuXG4gICAgICBzci5kZWZhdWx0cy5jb250YWluZXIgPSBfcmVzb2x2ZUNvbnRhaW5lcihzci5kZWZhdWx0cylcblxuICAgICAgc3Iuc3RvcmUgPSB7XG4gICAgICAgIGVsZW1lbnRzOiB7fSxcbiAgICAgICAgY29udGFpbmVyczogW11cbiAgICAgIH1cblxuICAgICAgc3Iuc2VxdWVuY2VzID0ge31cbiAgICAgIHNyLmhpc3RvcnkgPSBbXVxuICAgICAgc3IudWlkID0gMFxuICAgICAgc3IuaW5pdGlhbGl6ZWQgPSBmYWxzZVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUgIT09IG51bGwpIHtcbiAgICAgIC8vIE5vdGU6IElFOSBvbmx5IHN1cHBvcnRzIGNvbnNvbGUgaWYgZGV2dG9vbHMgYXJlIG9wZW4uXG4gICAgICBjb25zb2xlLmxvZygnU2Nyb2xsUmV2ZWFsIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyLicpXG4gICAgfVxuXG4gICAgcmV0dXJuIHNyXG4gIH1cblxuICAvKipcbiAgICogQ29uZmlndXJhdGlvblxuICAgKiAtLS0tLS0tLS0tLS0tXG4gICAqIFRoaXMgb2JqZWN0IHNpZ25hdHVyZSBjYW4gYmUgcGFzc2VkIGRpcmVjdGx5IHRvIHRoZSBTY3JvbGxSZXZlYWwgY29uc3RydWN0b3IsXG4gICAqIG9yIGFzIHRoZSBzZWNvbmQgYXJndW1lbnQgb2YgdGhlIGByZXZlYWwoKWAgbWV0aG9kLlxuICAgKi9cblxuICBTY3JvbGxSZXZlYWwucHJvdG90eXBlLmRlZmF1bHRzID0ge1xuICAgIC8vICdib3R0b20nLCAnbGVmdCcsICd0b3AnLCAncmlnaHQnXG4gICAgb3JpZ2luOiAnYm90dG9tJyxcblxuICAgIC8vIENhbiBiZSBhbnkgdmFsaWQgQ1NTIGRpc3RhbmNlLCBlLmcuICc1cmVtJywgJzEwJScsICcyMHZ3JywgZXRjLlxuICAgIGRpc3RhbmNlOiAnMjBweCcsXG5cbiAgICAvLyBUaW1lIGluIG1pbGxpc2Vjb25kcy5cbiAgICBkdXJhdGlvbjogNTAwLFxuICAgIGRlbGF5OiAwLFxuXG4gICAgLy8gU3RhcnRpbmcgYW5nbGVzIGluIGRlZ3JlZXMsIHdpbGwgdHJhbnNpdGlvbiBmcm9tIHRoZXNlIHZhbHVlcyB0byAwIGluIGFsbCBheGVzLlxuICAgIHJvdGF0ZTogeyB4OiAwLCB5OiAwLCB6OiAwIH0sXG5cbiAgICAvLyBTdGFydGluZyBvcGFjaXR5IHZhbHVlLCBiZWZvcmUgdHJhbnNpdGlvbmluZyB0byB0aGUgY29tcHV0ZWQgb3BhY2l0eS5cbiAgICBvcGFjaXR5OiAwLFxuXG4gICAgLy8gU3RhcnRpbmcgc2NhbGUgdmFsdWUsIHdpbGwgdHJhbnNpdGlvbiBmcm9tIHRoaXMgdmFsdWUgdG8gMVxuICAgIHNjYWxlOiAwLjksXG5cbiAgICAvLyBBY2NlcHRzIGFueSB2YWxpZCBDU1MgZWFzaW5nLCBlLmcuICdlYXNlJywgJ2Vhc2UtaW4tb3V0JywgJ2xpbmVhcicsIGV0Yy5cbiAgICBlYXNpbmc6ICdjdWJpYy1iZXppZXIoMC42LCAwLjIsIDAuMSwgMSknLFxuXG4gICAgLy8gYDxodG1sPmAgaXMgdGhlIGRlZmF1bHQgcmV2ZWFsIGNvbnRhaW5lci4gWW91IGNhbiBwYXNzIGVpdGhlcjpcbiAgICAvLyBET00gTm9kZSwgZS5nLiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9vQ29udGFpbmVyJylcbiAgICAvLyBTZWxlY3RvciwgZS5nLiAnLmZvb0NvbnRhaW5lcidcbiAgICBjb250YWluZXI6IHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsXG5cbiAgICAvLyB0cnVlL2ZhbHNlIHRvIGNvbnRyb2wgcmV2ZWFsIGFuaW1hdGlvbnMgb24gbW9iaWxlLlxuICAgIG1vYmlsZTogdHJ1ZSxcblxuICAgIC8vIHRydWU6ICByZXZlYWxzIG9jY3VyIGV2ZXJ5IHRpbWUgZWxlbWVudHMgYmVjb21lIHZpc2libGVcbiAgICAvLyBmYWxzZTogcmV2ZWFscyBvY2N1ciBvbmNlIGFzIGVsZW1lbnRzIGJlY29tZSB2aXNpYmxlXG4gICAgcmVzZXQ6IGZhbHNlLFxuXG4gICAgLy8gJ2Fsd2F5cycg4oCUIGRlbGF5IGZvciBhbGwgcmV2ZWFsIGFuaW1hdGlvbnNcbiAgICAvLyAnb25jZScgICDigJQgZGVsYXkgb25seSB0aGUgZmlyc3QgdGltZSByZXZlYWxzIG9jY3VyXG4gICAgLy8gJ29ubG9hZCcgLSBkZWxheSBvbmx5IGZvciBhbmltYXRpb25zIHRyaWdnZXJlZCBieSBmaXJzdCBsb2FkXG4gICAgdXNlRGVsYXk6ICdhbHdheXMnLFxuXG4gICAgLy8gQ2hhbmdlIHdoZW4gYW4gZWxlbWVudCBpcyBjb25zaWRlcmVkIGluIHRoZSB2aWV3cG9ydC4gVGhlIGRlZmF1bHQgdmFsdWVcbiAgICAvLyBvZiAwLjIwIG1lYW5zIDIwJSBvZiBhbiBlbGVtZW50IG11c3QgYmUgdmlzaWJsZSBmb3IgaXRzIHJldmVhbCB0byBvY2N1ci5cbiAgICB2aWV3RmFjdG9yOiAwLjIsXG5cbiAgICAvLyBQaXhlbCB2YWx1ZXMgdGhhdCBhbHRlciB0aGUgY29udGFpbmVyIGJvdW5kYXJpZXMuXG4gICAgLy8gZS5nLiBTZXQgYHsgdG9wOiA0OCB9YCwgaWYgeW91IGhhdmUgYSA0OHB4IHRhbGwgZml4ZWQgdG9vbGJhci5cbiAgICAvLyAtLVxuICAgIC8vIFZpc3VhbCBBaWQ6IGh0dHBzOi8vc2Nyb2xscmV2ZWFsanMub3JnL2Fzc2V0cy92aWV3b2Zmc2V0LnBuZ1xuICAgIHZpZXdPZmZzZXQ6IHsgdG9wOiAwLCByaWdodDogMCwgYm90dG9tOiAwLCBsZWZ0OiAwIH0sXG5cbiAgICAvLyBDYWxsYmFja3MgdGhhdCBmaXJlIGZvciBlYWNoIHRyaWdnZXJlZCBlbGVtZW50IHJldmVhbCwgYW5kIHJlc2V0LlxuICAgIGJlZm9yZVJldmVhbDogZnVuY3Rpb24gKGRvbUVsKSB7fSxcbiAgICBiZWZvcmVSZXNldDogZnVuY3Rpb24gKGRvbUVsKSB7fSxcblxuICAgIC8vIENhbGxiYWNrcyB0aGF0IGZpcmUgZm9yIGVhY2ggY29tcGxldGVkIGVsZW1lbnQgcmV2ZWFsLCBhbmQgcmVzZXQuXG4gICAgYWZ0ZXJSZXZlYWw6IGZ1bmN0aW9uIChkb21FbCkge30sXG4gICAgYWZ0ZXJSZXNldDogZnVuY3Rpb24gKGRvbUVsKSB7fVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGNsaWVudCBzdXBwb3J0cyBDU1MgVHJhbnNmb3JtIGFuZCBDU1MgVHJhbnNpdGlvbi5cbiAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICovXG4gIFNjcm9sbFJldmVhbC5wcm90b3R5cGUuaXNTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlXG4gICAgcmV0dXJuICdXZWJraXRUcmFuc2l0aW9uJyBpbiBzdHlsZSAmJiAnV2Via2l0VHJhbnNmb3JtJyBpbiBzdHlsZSB8fFxuICAgICAgJ3RyYW5zaXRpb24nIGluIHN0eWxlICYmICd0cmFuc2Zvcm0nIGluIHN0eWxlXG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIHJldmVhbCBzZXQsIGEgZ3JvdXAgb2YgZWxlbWVudHMgdGhhdCB3aWxsIGFuaW1hdGUgd2hlbiB0aGV5XG4gICAqIGJlY29tZSB2aXNpYmxlLiBJZiBbaW50ZXJ2YWxdIGlzIHByb3ZpZGVkLCBhIG5ldyBzZXF1ZW5jZSBpcyBjcmVhdGVkXG4gICAqIHRoYXQgd2lsbCBlbnN1cmUgZWxlbWVudHMgcmV2ZWFsIGluIHRoZSBvcmRlciB0aGV5IGFwcGVhciBpbiB0aGUgRE9NLlxuICAgKlxuICAgKiBAcGFyYW0ge05vZGV8Tm9kZUxpc3R8c3RyaW5nfSBbdGFyZ2V0XSAgIFRoZSBub2RlLCBub2RlIGxpc3Qgb3Igc2VsZWN0b3IgdG8gdXNlIGZvciBhbmltYXRpb24uXG4gICAqIEBwYXJhbSB7T2JqZWN0fSAgICAgICAgICAgICAgIFtjb25maWddICAgT3ZlcnJpZGUgdGhlIGRlZmF1bHRzIGZvciB0aGlzIHJldmVhbCBzZXQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSAgICAgICAgICAgICAgIFtpbnRlcnZhbF0gVGltZSBiZXR3ZWVuIHNlcXVlbmNlZCBlbGVtZW50IGFuaW1hdGlvbnMgKG1pbGxpc2Vjb25kcykuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gICAgICAgICAgICAgIFtzeW5jXSAgICAgVXNlZCBpbnRlcm5hbGx5IHdoZW4gdXBkYXRpbmcgcmV2ZWFscyBmb3IgYXN5bmMgY29udGVudC5cbiAgICpcbiAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgY3VycmVudCBTY3JvbGxSZXZlYWwgaW5zdGFuY2UuXG4gICAqL1xuICBTY3JvbGxSZXZlYWwucHJvdG90eXBlLnJldmVhbCA9IGZ1bmN0aW9uICh0YXJnZXQsIGNvbmZpZywgaW50ZXJ2YWwsIHN5bmMpIHtcbiAgICB2YXIgY29udGFpbmVyXG4gICAgdmFyIGVsZW1lbnRzXG4gICAgdmFyIGVsZW1cbiAgICB2YXIgZWxlbUlkXG4gICAgdmFyIHNlcXVlbmNlXG4gICAgdmFyIHNlcXVlbmNlSWRcblxuICAgIC8vIE5vIGN1c3RvbSBjb25maWd1cmF0aW9uIHdhcyBwYXNzZWQsIGJ1dCBhIHNlcXVlbmNlIGludGVydmFsIGluc3RlYWQuXG4gICAgLy8gbGV04oCZcyBzaHVmZmxlIHRoaW5ncyBhcm91bmQgdG8gbWFrZSBzdXJlIGV2ZXJ5dGhpbmcgd29ya3MuXG4gICAgaWYgKGNvbmZpZyAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBjb25maWcgPT09ICdudW1iZXInKSB7XG4gICAgICBpbnRlcnZhbCA9IGNvbmZpZ1xuICAgICAgY29uZmlnID0ge31cbiAgICB9IGVsc2UgaWYgKGNvbmZpZyA9PT0gdW5kZWZpbmVkIHx8IGNvbmZpZyA9PT0gbnVsbCkge1xuICAgICAgY29uZmlnID0ge31cbiAgICB9XG5cbiAgICBjb250YWluZXIgPSBfcmVzb2x2ZUNvbnRhaW5lcihjb25maWcpXG4gICAgZWxlbWVudHMgPSBfZ2V0UmV2ZWFsRWxlbWVudHModGFyZ2V0LCBjb250YWluZXIpXG5cbiAgICBpZiAoIWVsZW1lbnRzLmxlbmd0aCkge1xuICAgICAgY29uc29sZS5sb2coJ1Njcm9sbFJldmVhbDogcmV2ZWFsIG9uIFwiJyArIHRhcmdldCArICdcIiBmYWlsZWQsIG5vIGVsZW1lbnRzIGZvdW5kLicpXG4gICAgICByZXR1cm4gc3JcbiAgICB9XG5cbiAgICAvLyBQcmVwYXJlIGEgbmV3IHNlcXVlbmNlIGlmIGFuIGludGVydmFsIGlzIHBhc3NlZC5cbiAgICBpZiAoaW50ZXJ2YWwgJiYgdHlwZW9mIGludGVydmFsID09PSAnbnVtYmVyJykge1xuICAgICAgc2VxdWVuY2VJZCA9IF9uZXh0VWlkKClcblxuICAgICAgc2VxdWVuY2UgPSBzci5zZXF1ZW5jZXNbc2VxdWVuY2VJZF0gPSB7XG4gICAgICAgIGlkOiBzZXF1ZW5jZUlkLFxuICAgICAgICBpbnRlcnZhbDogaW50ZXJ2YWwsXG4gICAgICAgIGVsZW1JZHM6IFtdLFxuICAgICAgICBhY3RpdmU6IGZhbHNlXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQmVnaW4gbWFpbiBsb29wIHRvIGNvbmZpZ3VyZSBTY3JvbGxSZXZlYWwgZWxlbWVudHMuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgLy8gQ2hlY2sgaWYgdGhlIGVsZW1lbnQgaGFzIGFscmVhZHkgYmVlbiBjb25maWd1cmVkIGFuZCBncmFiIGl0IGZyb20gdGhlIHN0b3JlLlxuICAgICAgZWxlbUlkID0gZWxlbWVudHNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXNyLWlkJylcbiAgICAgIGlmIChlbGVtSWQpIHtcbiAgICAgICAgZWxlbSA9IHNyLnN0b3JlLmVsZW1lbnRzW2VsZW1JZF1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE90aGVyd2lzZSwgbGV04oCZcyBkbyBzb21lIGJhc2ljIHNldHVwLlxuICAgICAgICBlbGVtID0ge1xuICAgICAgICAgIGlkOiBfbmV4dFVpZCgpLFxuICAgICAgICAgIGRvbUVsOiBlbGVtZW50c1tpXSxcbiAgICAgICAgICBzZWVuOiBmYWxzZSxcbiAgICAgICAgICByZXZlYWxpbmc6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgICAgZWxlbS5kb21FbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3ItaWQnLCBlbGVtLmlkKVxuICAgICAgfVxuXG4gICAgICAvLyBTZXF1ZW5jZSBvbmx5IHNldHVwXG4gICAgICBpZiAoc2VxdWVuY2UpIHtcbiAgICAgICAgZWxlbS5zZXF1ZW5jZSA9IHtcbiAgICAgICAgICBpZDogc2VxdWVuY2UuaWQsXG4gICAgICAgICAgaW5kZXg6IHNlcXVlbmNlLmVsZW1JZHMubGVuZ3RoXG4gICAgICAgIH1cblxuICAgICAgICBzZXF1ZW5jZS5lbGVtSWRzLnB1c2goZWxlbS5pZClcbiAgICAgIH1cblxuICAgICAgLy8gTmV3IG9yIGV4aXN0aW5nIGVsZW1lbnQsIGl04oCZcyB0aW1lIHRvIHVwZGF0ZSBpdHMgY29uZmlndXJhdGlvbiwgc3R5bGVzLFxuICAgICAgLy8gYW5kIHNlbmQgdGhlIHVwZGF0ZXMgdG8gb3VyIHN0b3JlLlxuICAgICAgX2NvbmZpZ3VyZShlbGVtLCBjb25maWcsIGNvbnRhaW5lcilcbiAgICAgIF9zdHlsZShlbGVtKVxuICAgICAgX3VwZGF0ZVN0b3JlKGVsZW0pXG5cbiAgICAgIC8vIFdlIG5lZWQgdG8gbWFrZSBzdXJlIGVsZW1lbnRzIGFyZSBzZXQgdG8gdmlzaWJpbGl0eTogdmlzaWJsZSwgZXZlbiB3aGVuXG4gICAgICAvLyBvbiBtb2JpbGUgYW5kIGBjb25maWcubW9iaWxlID09PSBmYWxzZWAsIG9yIGlmIHVuc3VwcG9ydGVkLlxuICAgICAgaWYgKHNyLnRvb2xzLmlzTW9iaWxlKCkgJiYgIWVsZW0uY29uZmlnLm1vYmlsZSB8fCAhc3IuaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICBlbGVtLmRvbUVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBlbGVtLnN0eWxlcy5pbmxpbmUpXG4gICAgICAgIGVsZW0uZGlzYWJsZWQgPSB0cnVlXG4gICAgICB9IGVsc2UgaWYgKCFlbGVtLnJldmVhbGluZykge1xuICAgICAgICAvLyBPdGhlcndpc2UsIHByb2NlZWQgbm9ybWFsbHkuXG4gICAgICAgIGVsZW0uZG9tRWwuc2V0QXR0cmlidXRlKCdzdHlsZScsXG4gICAgICAgICAgZWxlbS5zdHlsZXMuaW5saW5lICtcbiAgICAgICAgICBlbGVtLnN0eWxlcy50cmFuc2Zvcm0uaW5pdGlhbFxuICAgICAgICApXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRWFjaCBgcmV2ZWFsKClgIGlzIHJlY29yZGVkIHNvIHRoYXQgd2hlbiBjYWxsaW5nIGBzeW5jKClgIHdoaWxlIHdvcmtpbmdcbiAgICAvLyB3aXRoIGFzeW5jaHJvbm91c2x5IGxvYWRlZCBjb250ZW50LCBpdCBjYW4gcmUtdHJhY2UgeW91ciBzdGVwcyBidXQgd2l0aFxuICAgIC8vIGFsbCB5b3VyIG5ldyBlbGVtZW50cyBub3cgaW4gdGhlIERPTS5cblxuICAgIC8vIFNpbmNlIGByZXZlYWwoKWAgaXMgY2FsbGVkIGludGVybmFsbHkgYnkgYHN5bmMoKWAsIHdlIGRvbuKAmXQgd2FudCB0b1xuICAgIC8vIHJlY29yZCBvciBpbnRpaWFsaXplIGVhY2ggcmV2ZWFsIGR1cmluZyBzeW5jaW5nLlxuICAgIGlmICghc3luYyAmJiBzci5pc1N1cHBvcnRlZCgpKSB7XG4gICAgICBfcmVjb3JkKHRhcmdldCwgY29uZmlnLCBpbnRlcnZhbClcblxuICAgICAgLy8gV2UgcHVzaCBpbml0aWFsaXphdGlvbiB0byB0aGUgZXZlbnQgcXVldWUgdXNpbmcgc2V0VGltZW91dCwgc28gdGhhdCB3ZSBjYW5cbiAgICAgIC8vIGdpdmUgU2Nyb2xsUmV2ZWFsIHJvb20gdG8gcHJvY2VzcyBhbGwgcmV2ZWFsIGNhbGxzIGJlZm9yZSBwdXR0aW5nIHRoaW5ncyBpbnRvIG1vdGlvbi5cbiAgICAgIC8vIC0tXG4gICAgICAvLyBQaGlsaXAgUm9iZXJ0cyAtIFdoYXQgdGhlIGhlY2sgaXMgdGhlIGV2ZW50IGxvb3AgYW55d2F5PyAoSlNDb25mIEVVIDIwMTQpXG4gICAgICAvLyBodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PThhR2haUWtvRmJRXG4gICAgICBpZiAoc3IuaW5pdFRpbWVvdXQpIHtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChzci5pbml0VGltZW91dClcbiAgICAgIH1cbiAgICAgIHNyLmluaXRUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoX2luaXQsIDApXG4gICAgfVxuXG4gICAgcmV0dXJuIHNyXG4gIH1cblxuICAvKipcbiAgICogUmUtcnVucyBgcmV2ZWFsKClgIGZvciBlYWNoIHJlY29yZCBzdG9yZWQgaW4gaGlzdG9yeSwgZWZmZWN0aXZlbHkgY2FwdHVyaW5nXG4gICAqIGFueSBjb250ZW50IGxvYWRlZCBhc3luY2hyb25vdXNseSB0aGF0IG1hdGNoZXMgZXhpc3RpbmcgcmV2ZWFsIHNldCB0YXJnZXRzLlxuICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBjdXJyZW50IFNjcm9sbFJldmVhbCBpbnN0YW5jZS5cbiAgICovXG4gIFNjcm9sbFJldmVhbC5wcm90b3R5cGUuc3luYyA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoc3IuaGlzdG9yeS5sZW5ndGggJiYgc3IuaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzci5oaXN0b3J5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciByZWNvcmQgPSBzci5oaXN0b3J5W2ldXG4gICAgICAgIHNyLnJldmVhbChyZWNvcmQudGFyZ2V0LCByZWNvcmQuY29uZmlnLCByZWNvcmQuaW50ZXJ2YWwsIHRydWUpXG4gICAgICB9XG4gICAgICBfaW5pdCgpXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKCdTY3JvbGxSZXZlYWw6IHN5bmMgZmFpbGVkLCBubyByZXZlYWxzIGZvdW5kLicpXG4gICAgfVxuICAgIHJldHVybiBzclxuICB9XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgTWV0aG9kc1xuICAgKiAtLS0tLS0tLS0tLS0tLS1cbiAgICovXG5cbiAgZnVuY3Rpb24gX3Jlc29sdmVDb250YWluZXIgKGNvbmZpZykge1xuICAgIGlmIChjb25maWcgJiYgY29uZmlnLmNvbnRhaW5lcikge1xuICAgICAgaWYgKHR5cGVvZiBjb25maWcuY29udGFpbmVyID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5jb250YWluZXIpXG4gICAgICB9IGVsc2UgaWYgKHNyLnRvb2xzLmlzTm9kZShjb25maWcuY29udGFpbmVyKSkge1xuICAgICAgICByZXR1cm4gY29uZmlnLmNvbnRhaW5lclxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1Njcm9sbFJldmVhbDogaW52YWxpZCBjb250YWluZXIgXCInICsgY29uZmlnLmNvbnRhaW5lciArICdcIiBwcm92aWRlZC4nKVxuICAgICAgICBjb25zb2xlLmxvZygnU2Nyb2xsUmV2ZWFsOiBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdCBjb250YWluZXIuJylcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNyLmRlZmF1bHRzLmNvbnRhaW5lclxuICB9XG5cbiAgLyoqXG4gICAqIGNoZWNrIHRvIHNlZSBpZiBhIG5vZGUgb3Igbm9kZSBsaXN0IHdhcyBwYXNzZWQgaW4gYXMgdGhlIHRhcmdldCxcbiAgICogb3RoZXJ3aXNlIHF1ZXJ5IHRoZSBjb250YWluZXIgdXNpbmcgdGFyZ2V0IGFzIGEgc2VsZWN0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7Tm9kZXxOb2RlTGlzdHxzdHJpbmd9IFt0YXJnZXRdICAgIGNsaWVudCBpbnB1dCBmb3IgcmV2ZWFsIHRhcmdldC5cbiAgICogQHBhcmFtIHtOb2RlfSAgICAgICAgICAgICAgICAgW2NvbnRhaW5lcl0gcGFyZW50IGVsZW1lbnQgZm9yIHNlbGVjdG9yIHF1ZXJpZXMuXG4gICAqXG4gICAqIEByZXR1cm4ge2FycmF5fSBlbGVtZW50cyB0byBiZSByZXZlYWxlZC5cbiAgICovXG4gIGZ1bmN0aW9uIF9nZXRSZXZlYWxFbGVtZW50cyAodGFyZ2V0LCBjb250YWluZXIpIHtcbiAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCh0YXJnZXQpKVxuICAgIH0gZWxzZSBpZiAoc3IudG9vbHMuaXNOb2RlKHRhcmdldCkpIHtcbiAgICAgIHJldHVybiBbdGFyZ2V0XVxuICAgIH0gZWxzZSBpZiAoc3IudG9vbHMuaXNOb2RlTGlzdCh0YXJnZXQpKSB7XG4gICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGFyZ2V0KVxuICAgIH1cbiAgICByZXR1cm4gW11cbiAgfVxuXG4gIC8qKlxuICAgKiBBIGNvbnNpc3RlbnQgd2F5IG9mIGNyZWF0aW5nIHVuaXF1ZSBJRHMuXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAqL1xuICBmdW5jdGlvbiBfbmV4dFVpZCAoKSB7XG4gICAgcmV0dXJuICsrc3IudWlkXG4gIH1cblxuICBmdW5jdGlvbiBfY29uZmlndXJlIChlbGVtLCBjb25maWcsIGNvbnRhaW5lcikge1xuICAgIC8vIElmIGEgY29udGFpbmVyIHdhcyBwYXNzZWQgYXMgYSBwYXJ0IG9mIHRoZSBjb25maWcgb2JqZWN0LFxuICAgIC8vIGxldOKAmXMgb3ZlcndyaXRlIGl0IHdpdGggdGhlIHJlc29sdmVkIGNvbnRhaW5lciBwYXNzZWQgaW4uXG4gICAgaWYgKGNvbmZpZy5jb250YWluZXIpIGNvbmZpZy5jb250YWluZXIgPSBjb250YWluZXJcbiAgICAvLyBJZiB0aGUgZWxlbWVudCBoYXNu4oCZdCBhbHJlYWR5IGJlZW4gY29uZmlndXJlZCwgbGV04oCZcyB1c2UgYSBjbG9uZSBvZiB0aGVcbiAgICAvLyBkZWZhdWx0cyBleHRlbmRlZCBieSB0aGUgY29uZmlndXJhdGlvbiBwYXNzZWQgYXMgdGhlIHNlY29uZCBhcmd1bWVudC5cbiAgICBpZiAoIWVsZW0uY29uZmlnKSB7XG4gICAgICBlbGVtLmNvbmZpZyA9IHNyLnRvb2xzLmV4dGVuZENsb25lKHNyLmRlZmF1bHRzLCBjb25maWcpXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE90aGVyd2lzZSwgbGV04oCZcyB1c2UgYSBjbG9uZSBvZiB0aGUgZXhpc3RpbmcgZWxlbWVudCBjb25maWd1cmF0aW9uIGV4dGVuZGVkXG4gICAgICAvLyBieSB0aGUgY29uZmlndXJhdGlvbiBwYXNzZWQgYXMgdGhlIHNlY29uZCBhcmd1bWVudC5cbiAgICAgIGVsZW0uY29uZmlnID0gc3IudG9vbHMuZXh0ZW5kQ2xvbmUoZWxlbS5jb25maWcsIGNvbmZpZylcbiAgICB9XG5cbiAgICAvLyBJbmZlciBDU1MgVHJhbnNmb3JtIGF4aXMgZnJvbSBvcmlnaW4gc3RyaW5nLlxuICAgIGlmIChlbGVtLmNvbmZpZy5vcmlnaW4gPT09ICd0b3AnIHx8IGVsZW0uY29uZmlnLm9yaWdpbiA9PT0gJ2JvdHRvbScpIHtcbiAgICAgIGVsZW0uY29uZmlnLmF4aXMgPSAnWSdcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbS5jb25maWcuYXhpcyA9ICdYJ1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9zdHlsZSAoZWxlbSkge1xuICAgIHZhciBjb21wdXRlZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW0uZG9tRWwpXG5cbiAgICBpZiAoIWVsZW0uc3R5bGVzKSB7XG4gICAgICBlbGVtLnN0eWxlcyA9IHtcbiAgICAgICAgdHJhbnNpdGlvbjoge30sXG4gICAgICAgIHRyYW5zZm9ybToge30sXG4gICAgICAgIGNvbXB1dGVkOiB7fVxuICAgICAgfVxuXG4gICAgICAvLyBDYXB0dXJlIGFueSBleGlzdGluZyBpbmxpbmUgc3R5bGVzLCBhbmQgYWRkIG91ciB2aXNpYmlsaXR5IG92ZXJyaWRlLlxuICAgICAgLy8gLS1cbiAgICAgIC8vIFNlZSBzZWN0aW9uIDQuMi4gaW4gdGhlIERvY3VtZW50YXRpb246XG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vamxtYWtlcy9zY3JvbGxyZXZlYWwuanMjNDItaW1wcm92ZS11c2VyLWV4cGVyaWVuY2VcbiAgICAgIGVsZW0uc3R5bGVzLmlubGluZSA9IGVsZW0uZG9tRWwuZ2V0QXR0cmlidXRlKCdzdHlsZScpIHx8ICcnXG4gICAgICBlbGVtLnN0eWxlcy5pbmxpbmUgKz0gJzsgdmlzaWJpbGl0eTogdmlzaWJsZTsgJ1xuXG4gICAgICAvLyBncmFiIHRoZSBlbGVtZW50cyBleGlzdGluZyBvcGFjaXR5LlxuICAgICAgZWxlbS5zdHlsZXMuY29tcHV0ZWQub3BhY2l0eSA9IGNvbXB1dGVkLm9wYWNpdHlcblxuICAgICAgLy8gZ3JhYiB0aGUgZWxlbWVudHMgZXhpc3RpbmcgdHJhbnNpdGlvbnMuXG4gICAgICBpZiAoIWNvbXB1dGVkLnRyYW5zaXRpb24gfHwgY29tcHV0ZWQudHJhbnNpdGlvbiA9PT0gJ2FsbCAwcyBlYXNlIDBzJykge1xuICAgICAgICBlbGVtLnN0eWxlcy5jb21wdXRlZC50cmFuc2l0aW9uID0gJydcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW0uc3R5bGVzLmNvbXB1dGVkLnRyYW5zaXRpb24gPSBjb21wdXRlZC50cmFuc2l0aW9uICsgJywgJ1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSB0cmFuc2l0aW9uIHN0eWxlc1xuICAgIGVsZW0uc3R5bGVzLnRyYW5zaXRpb24uaW5zdGFudCA9IF9nZW5lcmF0ZVRyYW5zaXRpb24oZWxlbSwgMClcbiAgICBlbGVtLnN0eWxlcy50cmFuc2l0aW9uLmRlbGF5ZWQgPSBfZ2VuZXJhdGVUcmFuc2l0aW9uKGVsZW0sIGVsZW0uY29uZmlnLmRlbGF5KVxuXG4gICAgLy8gR2VuZXJhdGUgdHJhbnNmb3JtIHN0eWxlcywgZmlyc3Qgd2l0aCB0aGUgd2Via2l0IHByZWZpeC5cbiAgICBlbGVtLnN0eWxlcy50cmFuc2Zvcm0uaW5pdGlhbCA9ICcgLXdlYmtpdC10cmFuc2Zvcm06J1xuICAgIGVsZW0uc3R5bGVzLnRyYW5zZm9ybS50YXJnZXQgPSAnIC13ZWJraXQtdHJhbnNmb3JtOidcbiAgICBfZ2VuZXJhdGVUcmFuc2Zvcm0oZWxlbSlcblxuICAgIC8vIEFuZCBhZ2FpbiB3aXRob3V0IGFueSBwcmVmaXguXG4gICAgZWxlbS5zdHlsZXMudHJhbnNmb3JtLmluaXRpYWwgKz0gJ3RyYW5zZm9ybTonXG4gICAgZWxlbS5zdHlsZXMudHJhbnNmb3JtLnRhcmdldCArPSAndHJhbnNmb3JtOidcbiAgICBfZ2VuZXJhdGVUcmFuc2Zvcm0oZWxlbSlcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZW5lcmF0ZVRyYW5zaXRpb24gKGVsZW0sIGRlbGF5KSB7XG4gICAgdmFyIGNvbmZpZyA9IGVsZW0uY29uZmlnXG5cbiAgICByZXR1cm4gJy13ZWJraXQtdHJhbnNpdGlvbjogJyArIGVsZW0uc3R5bGVzLmNvbXB1dGVkLnRyYW5zaXRpb24gK1xuICAgICAgJy13ZWJraXQtdHJhbnNmb3JtICcgKyBjb25maWcuZHVyYXRpb24gLyAxMDAwICsgJ3MgJyArXG4gICAgICBjb25maWcuZWFzaW5nICsgJyAnICtcbiAgICAgIGRlbGF5IC8gMTAwMCArICdzLCBvcGFjaXR5ICcgK1xuICAgICAgY29uZmlnLmR1cmF0aW9uIC8gMTAwMCArICdzICcgK1xuICAgICAgY29uZmlnLmVhc2luZyArICcgJyArXG4gICAgICBkZWxheSAvIDEwMDAgKyAnczsgJyArXG5cbiAgICAgICd0cmFuc2l0aW9uOiAnICsgZWxlbS5zdHlsZXMuY29tcHV0ZWQudHJhbnNpdGlvbiArXG4gICAgICAndHJhbnNmb3JtICcgKyBjb25maWcuZHVyYXRpb24gLyAxMDAwICsgJ3MgJyArXG4gICAgICBjb25maWcuZWFzaW5nICsgJyAnICtcbiAgICAgIGRlbGF5IC8gMTAwMCArICdzLCBvcGFjaXR5ICcgK1xuICAgICAgY29uZmlnLmR1cmF0aW9uIC8gMTAwMCArICdzICcgK1xuICAgICAgY29uZmlnLmVhc2luZyArICcgJyArXG4gICAgICBkZWxheSAvIDEwMDAgKyAnczsgJ1xuICB9XG5cbiAgZnVuY3Rpb24gX2dlbmVyYXRlVHJhbnNmb3JtIChlbGVtKSB7XG4gICAgdmFyIGNvbmZpZyA9IGVsZW0uY29uZmlnXG4gICAgdmFyIGNzc0Rpc3RhbmNlXG4gICAgdmFyIHRyYW5zZm9ybSA9IGVsZW0uc3R5bGVzLnRyYW5zZm9ybVxuXG4gICAgLy8gTGV04oCZcyBtYWtlIHN1cmUgb3VyIG91ciBwaXhlbCBkaXN0YW5jZXMgYXJlIG5lZ2F0aXZlIGZvciB0b3AgYW5kIGxlZnQuXG4gICAgLy8gZS5nLiBvcmlnaW4gPSAndG9wJyBhbmQgZGlzdGFuY2UgPSAnMjVweCcgc3RhcnRzIGF0IGB0b3A6IC0yNXB4YCBpbiBDU1MuXG4gICAgaWYgKGNvbmZpZy5vcmlnaW4gPT09ICd0b3AnIHx8IGNvbmZpZy5vcmlnaW4gPT09ICdsZWZ0Jykge1xuICAgICAgY3NzRGlzdGFuY2UgPSAvXi0vLnRlc3QoY29uZmlnLmRpc3RhbmNlKVxuICAgICAgICA/IGNvbmZpZy5kaXN0YW5jZS5zdWJzdHIoMSlcbiAgICAgICAgOiAnLScgKyBjb25maWcuZGlzdGFuY2VcbiAgICB9IGVsc2Uge1xuICAgICAgY3NzRGlzdGFuY2UgPSBjb25maWcuZGlzdGFuY2VcbiAgICB9XG5cbiAgICBpZiAocGFyc2VJbnQoY29uZmlnLmRpc3RhbmNlKSkge1xuICAgICAgdHJhbnNmb3JtLmluaXRpYWwgKz0gJyB0cmFuc2xhdGUnICsgY29uZmlnLmF4aXMgKyAnKCcgKyBjc3NEaXN0YW5jZSArICcpJ1xuICAgICAgdHJhbnNmb3JtLnRhcmdldCArPSAnIHRyYW5zbGF0ZScgKyBjb25maWcuYXhpcyArICcoMCknXG4gICAgfVxuICAgIGlmIChjb25maWcuc2NhbGUpIHtcbiAgICAgIHRyYW5zZm9ybS5pbml0aWFsICs9ICcgc2NhbGUoJyArIGNvbmZpZy5zY2FsZSArICcpJ1xuICAgICAgdHJhbnNmb3JtLnRhcmdldCArPSAnIHNjYWxlKDEpJ1xuICAgIH1cbiAgICBpZiAoY29uZmlnLnJvdGF0ZS54KSB7XG4gICAgICB0cmFuc2Zvcm0uaW5pdGlhbCArPSAnIHJvdGF0ZVgoJyArIGNvbmZpZy5yb3RhdGUueCArICdkZWcpJ1xuICAgICAgdHJhbnNmb3JtLnRhcmdldCArPSAnIHJvdGF0ZVgoMCknXG4gICAgfVxuICAgIGlmIChjb25maWcucm90YXRlLnkpIHtcbiAgICAgIHRyYW5zZm9ybS5pbml0aWFsICs9ICcgcm90YXRlWSgnICsgY29uZmlnLnJvdGF0ZS55ICsgJ2RlZyknXG4gICAgICB0cmFuc2Zvcm0udGFyZ2V0ICs9ICcgcm90YXRlWSgwKSdcbiAgICB9XG4gICAgaWYgKGNvbmZpZy5yb3RhdGUueikge1xuICAgICAgdHJhbnNmb3JtLmluaXRpYWwgKz0gJyByb3RhdGVaKCcgKyBjb25maWcucm90YXRlLnogKyAnZGVnKSdcbiAgICAgIHRyYW5zZm9ybS50YXJnZXQgKz0gJyByb3RhdGVaKDApJ1xuICAgIH1cbiAgICB0cmFuc2Zvcm0uaW5pdGlhbCArPSAnOyBvcGFjaXR5OiAnICsgY29uZmlnLm9wYWNpdHkgKyAnOydcbiAgICB0cmFuc2Zvcm0udGFyZ2V0ICs9ICc7IG9wYWNpdHk6ICcgKyBlbGVtLnN0eWxlcy5jb21wdXRlZC5vcGFjaXR5ICsgJzsnXG4gIH1cblxuICBmdW5jdGlvbiBfdXBkYXRlU3RvcmUgKGVsZW0pIHtcbiAgICB2YXIgY29udGFpbmVyID0gZWxlbS5jb25maWcuY29udGFpbmVyXG5cbiAgICAvLyBJZiB0aGlzIGVsZW1lbnTigJlzIGNvbnRhaW5lciBpc27igJl0IGFscmVhZHkgaW4gdGhlIHN0b3JlLCBsZXTigJlzIGFkZCBpdC5cbiAgICBpZiAoY29udGFpbmVyICYmIHNyLnN0b3JlLmNvbnRhaW5lcnMuaW5kZXhPZihjb250YWluZXIpID09PSAtMSkge1xuICAgICAgc3Iuc3RvcmUuY29udGFpbmVycy5wdXNoKGVsZW0uY29uZmlnLmNvbnRhaW5lcilcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgdGhlIGVsZW1lbnQgc3RvcmVkIHdpdGggb3VyIG5ldyBlbGVtZW50LlxuICAgIHNyLnN0b3JlLmVsZW1lbnRzW2VsZW0uaWRdID0gZWxlbVxuICB9XG5cbiAgZnVuY3Rpb24gX3JlY29yZCAodGFyZ2V0LCBjb25maWcsIGludGVydmFsKSB7XG4gICAgLy8gU2F2ZSB0aGUgYHJldmVhbCgpYCBhcmd1bWVudHMgdGhhdCB0cmlnZ2VyZWQgdGhpcyBgX3JlY29yZCgpYCBjYWxsLCBzbyB3ZVxuICAgIC8vIGNhbiByZS10cmFjZSBvdXIgc3RlcHMgd2hlbiBjYWxsaW5nIHRoZSBgc3luYygpYCBtZXRob2QuXG4gICAgdmFyIHJlY29yZCA9IHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgY29uZmlnOiBjb25maWcsXG4gICAgICBpbnRlcnZhbDogaW50ZXJ2YWxcbiAgICB9XG4gICAgc3IuaGlzdG9yeS5wdXNoKHJlY29yZClcbiAgfVxuXG4gIGZ1bmN0aW9uIF9pbml0ICgpIHtcbiAgICBpZiAoc3IuaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgLy8gSW5pdGlhbCBhbmltYXRlIGNhbGwgdHJpZ2dlcnMgdmFsaWQgcmV2ZWFsIGFuaW1hdGlvbnMgb24gZmlyc3QgbG9hZC5cbiAgICAgIC8vIFN1YnNlcXVlbnQgYW5pbWF0ZSBjYWxscyBhcmUgbWFkZSBpbnNpZGUgdGhlIGV2ZW50IGhhbmRsZXIuXG4gICAgICBfYW5pbWF0ZSgpXG5cbiAgICAgIC8vIFRoZW4gd2UgbG9vcCB0aHJvdWdoIGFsbCBjb250YWluZXIgbm9kZXMgaW4gdGhlIHN0b3JlIGFuZCBiaW5kIGV2ZW50XG4gICAgICAvLyBsaXN0ZW5lcnMgdG8gZWFjaC5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Iuc3RvcmUuY29udGFpbmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBzci5zdG9yZS5jb250YWluZXJzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIF9oYW5kbGVyKVxuICAgICAgICBzci5zdG9yZS5jb250YWluZXJzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIF9oYW5kbGVyKVxuICAgICAgfVxuXG4gICAgICAvLyBMZXTigJlzIGFsc28gZG8gYSBvbmUtdGltZSBiaW5kaW5nIG9mIHdpbmRvdyBldmVudCBsaXN0ZW5lcnMuXG4gICAgICBpZiAoIXNyLmluaXRpYWxpemVkKSB7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBfaGFuZGxlcilcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIF9oYW5kbGVyKVxuICAgICAgICBzci5pbml0aWFsaXplZCA9IHRydWVcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNyXG4gIH1cblxuICBmdW5jdGlvbiBfaGFuZGxlciAoKSB7XG4gICAgX3JlcXVlc3RBbmltYXRpb25GcmFtZShfYW5pbWF0ZSlcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zZXRBY3RpdmVTZXF1ZW5jZXMgKCkge1xuICAgIHZhciBhY3RpdmVcbiAgICB2YXIgZWxlbVxuICAgIHZhciBlbGVtSWRcbiAgICB2YXIgc2VxdWVuY2VcblxuICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgc2VxdWVuY2VzXG4gICAgc3IudG9vbHMuZm9yT3duKHNyLnNlcXVlbmNlcywgZnVuY3Rpb24gKHNlcXVlbmNlSWQpIHtcbiAgICAgIHNlcXVlbmNlID0gc3Iuc2VxdWVuY2VzW3NlcXVlbmNlSWRdXG4gICAgICBhY3RpdmUgPSBmYWxzZVxuXG4gICAgICAvLyBGb3IgZWFjaCBzZXF1ZW5jZWQgZWxlbWVuZXQsIGxldOKAmXMgY2hlY2sgdmlzaWJpbGl0eSBhbmQgaWZcbiAgICAgIC8vIGFueSBhcmUgdmlzaWJsZSwgc2V0IGl04oCZcyBzZXF1ZW5jZSB0byBhY3RpdmUuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlcXVlbmNlLmVsZW1JZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZWxlbUlkID0gc2VxdWVuY2UuZWxlbUlkc1tpXVxuICAgICAgICBlbGVtID0gc3Iuc3RvcmUuZWxlbWVudHNbZWxlbUlkXVxuICAgICAgICBpZiAoX2lzRWxlbVZpc2libGUoZWxlbSkgJiYgIWFjdGl2ZSkge1xuICAgICAgICAgIGFjdGl2ZSA9IHRydWVcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBzZXF1ZW5jZS5hY3RpdmUgPSBhY3RpdmVcbiAgICB9KVxuICB9XG5cbiAgZnVuY3Rpb24gX2FuaW1hdGUgKCkge1xuICAgIHZhciBkZWxheWVkXG4gICAgdmFyIGVsZW1cblxuICAgIF9zZXRBY3RpdmVTZXF1ZW5jZXMoKVxuXG4gICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBlbGVtZW50cyBpbiB0aGUgc3RvcmVcbiAgICBzci50b29scy5mb3JPd24oc3Iuc3RvcmUuZWxlbWVudHMsIGZ1bmN0aW9uIChlbGVtSWQpIHtcbiAgICAgIGVsZW0gPSBzci5zdG9yZS5lbGVtZW50c1tlbGVtSWRdXG4gICAgICBkZWxheWVkID0gX3Nob3VsZFVzZURlbGF5KGVsZW0pXG5cbiAgICAgIC8vIExldOKAmXMgc2VlIGlmIHdlIHNob3VsZCByZXZlYWxhbmQgaWYgc28sXG4gICAgICAvLyB0cmlnZ2VyIHRoZSBgYmVmb3JlUmV2ZWFsYCBjYWxsYmFjayBhbmRcbiAgICAgIC8vIGRldGVybWluZSB3aGV0aGVyIG9yIG5vdCB0byB1c2UgZGVsYXkuXG4gICAgICBpZiAoX3Nob3VsZFJldmVhbChlbGVtKSkge1xuICAgICAgICBlbGVtLmNvbmZpZy5iZWZvcmVSZXZlYWwoZWxlbS5kb21FbClcbiAgICAgICAgaWYgKGRlbGF5ZWQpIHtcbiAgICAgICAgICBlbGVtLmRvbUVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLFxuICAgICAgICAgICAgZWxlbS5zdHlsZXMuaW5saW5lICtcbiAgICAgICAgICAgIGVsZW0uc3R5bGVzLnRyYW5zZm9ybS50YXJnZXQgK1xuICAgICAgICAgICAgZWxlbS5zdHlsZXMudHJhbnNpdGlvbi5kZWxheWVkXG4gICAgICAgICAgKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsZW0uZG9tRWwuc2V0QXR0cmlidXRlKCdzdHlsZScsXG4gICAgICAgICAgICBlbGVtLnN0eWxlcy5pbmxpbmUgK1xuICAgICAgICAgICAgZWxlbS5zdHlsZXMudHJhbnNmb3JtLnRhcmdldCArXG4gICAgICAgICAgICBlbGVtLnN0eWxlcy50cmFuc2l0aW9uLmluc3RhbnRcbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICAvLyBMZXTigJlzIHF1ZXVlIHRoZSBgYWZ0ZXJSZXZlYWxgIGNhbGxiYWNrXG4gICAgICAgIC8vIGFuZCBtYXJrIHRoZSBlbGVtZW50IGFzIHNlZW4gYW5kIHJldmVhbGluZy5cbiAgICAgICAgX3F1ZXVlQ2FsbGJhY2soJ3JldmVhbCcsIGVsZW0sIGRlbGF5ZWQpXG4gICAgICAgIGVsZW0ucmV2ZWFsaW5nID0gdHJ1ZVxuICAgICAgICBlbGVtLnNlZW4gPSB0cnVlXG5cbiAgICAgICAgaWYgKGVsZW0uc2VxdWVuY2UpIHtcbiAgICAgICAgICBfcXVldWVOZXh0SW5TZXF1ZW5jZShlbGVtLCBkZWxheWVkKVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKF9zaG91bGRSZXNldChlbGVtKSkge1xuICAgICAgICAvL090aGVyd2lzZSByZXNldCBvdXIgZWxlbWVudCBhbmRcbiAgICAgICAgLy8gdHJpZ2dlciB0aGUgYGJlZm9yZVJlc2V0YCBjYWxsYmFjay5cbiAgICAgICAgZWxlbS5jb25maWcuYmVmb3JlUmVzZXQoZWxlbS5kb21FbClcbiAgICAgICAgZWxlbS5kb21FbC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJyxcbiAgICAgICAgICBlbGVtLnN0eWxlcy5pbmxpbmUgK1xuICAgICAgICAgIGVsZW0uc3R5bGVzLnRyYW5zZm9ybS5pbml0aWFsICtcbiAgICAgICAgICBlbGVtLnN0eWxlcy50cmFuc2l0aW9uLmluc3RhbnRcbiAgICAgICAgKVxuICAgICAgICAvLyBBbmQgcXVldWUgdGhlIGBhZnRlclJlc2V0YCBjYWxsYmFjay5cbiAgICAgICAgX3F1ZXVlQ2FsbGJhY2soJ3Jlc2V0JywgZWxlbSlcbiAgICAgICAgZWxlbS5yZXZlYWxpbmcgPSBmYWxzZVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBmdW5jdGlvbiBfcXVldWVOZXh0SW5TZXF1ZW5jZSAoZWxlbSwgZGVsYXllZCkge1xuICAgIHZhciBlbGFwc2VkID0gMFxuICAgIHZhciBkZWxheSA9IDBcbiAgICB2YXIgc2VxdWVuY2UgPSBzci5zZXF1ZW5jZXNbZWxlbS5zZXF1ZW5jZS5pZF1cblxuICAgIC8vIFdl4oCZcmUgcHJvY2Vzc2luZyBhIHNlcXVlbmNlZCBlbGVtZW50LCBzbyBsZXQncyBibG9jayBvdGhlciBlbGVtZW50cyBpbiB0aGlzIHNlcXVlbmNlLlxuICAgIHNlcXVlbmNlLmJsb2NrZWQgPSB0cnVlXG5cbiAgICAvLyBTaW5jZSB3ZeKAmXJlIHRyaWdnZXJpbmcgYW5pbWF0aW9ucyBhIHBhcnQgb2YgYSBzZXF1ZW5jZSBhZnRlciBhbmltYXRpb25zIG9uIGZpcnN0IGxvYWQsXG4gICAgLy8gd2UgbmVlZCB0byBjaGVjayBmb3IgdGhhdCBjb25kaXRpb24gYW5kIGV4cGxpY2l0bHkgYWRkIHRoZSBkZWxheSB0byBvdXIgdGltZXIuXG4gICAgaWYgKGRlbGF5ZWQgJiYgZWxlbS5jb25maWcudXNlRGVsYXkgPT09ICdvbmxvYWQnKSB7XG4gICAgICBkZWxheSA9IGVsZW0uY29uZmlnLmRlbGF5XG4gICAgfVxuXG4gICAgLy8gSWYgYSBzZXF1ZW5jZSB0aW1lciBpcyBhbHJlYWR5IHJ1bm5pbmcsIGNhcHR1cmUgdGhlIGVsYXBzZWQgdGltZSBhbmQgY2xlYXIgaXQuXG4gICAgaWYgKGVsZW0uc2VxdWVuY2UudGltZXIpIHtcbiAgICAgIGVsYXBzZWQgPSBNYXRoLmFicyhlbGVtLnNlcXVlbmNlLnRpbWVyLnN0YXJ0ZWQgLSBuZXcgRGF0ZSgpKVxuICAgICAgd2luZG93LmNsZWFyVGltZW91dChlbGVtLnNlcXVlbmNlLnRpbWVyKVxuICAgIH1cblxuICAgIC8vIFN0YXJ0IGEgbmV3IHRpbWVyLlxuICAgIGVsZW0uc2VxdWVuY2UudGltZXIgPSB7IHN0YXJ0ZWQ6IG5ldyBEYXRlKCkgfVxuICAgIGVsZW0uc2VxdWVuY2UudGltZXIuY2xvY2sgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBTZXF1ZW5jZSBpbnRlcnZhbCBoYXMgcGFzc2VkLCBzbyB1bmJsb2NrIHRoZSBzZXF1ZW5jZSBhbmQgcmUtcnVuIHRoZSBoYW5kbGVyLlxuICAgICAgc2VxdWVuY2UuYmxvY2tlZCA9IGZhbHNlXG4gICAgICBlbGVtLnNlcXVlbmNlLnRpbWVyID0gbnVsbFxuICAgICAgX2hhbmRsZXIoKVxuICAgIH0sIE1hdGguYWJzKHNlcXVlbmNlLmludGVydmFsKSArIGRlbGF5IC0gZWxhcHNlZClcbiAgfVxuXG4gIGZ1bmN0aW9uIF9xdWV1ZUNhbGxiYWNrICh0eXBlLCBlbGVtLCBkZWxheWVkKSB7XG4gICAgdmFyIGVsYXBzZWQgPSAwXG4gICAgdmFyIGR1cmF0aW9uID0gMFxuICAgIHZhciBjYWxsYmFjayA9ICdhZnRlcidcblxuICAgIC8vIENoZWNrIHdoaWNoIGNhbGxiYWNrIHdl4oCZcmUgd29ya2luZyB3aXRoLlxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAncmV2ZWFsJzpcbiAgICAgICAgZHVyYXRpb24gPSBlbGVtLmNvbmZpZy5kdXJhdGlvblxuICAgICAgICBpZiAoZGVsYXllZCkge1xuICAgICAgICAgIGR1cmF0aW9uICs9IGVsZW0uY29uZmlnLmRlbGF5XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2sgKz0gJ1JldmVhbCdcbiAgICAgICAgYnJlYWtcblxuICAgICAgY2FzZSAncmVzZXQnOlxuICAgICAgICBkdXJhdGlvbiA9IGVsZW0uY29uZmlnLmR1cmF0aW9uXG4gICAgICAgIGNhbGxiYWNrICs9ICdSZXNldCdcbiAgICAgICAgYnJlYWtcbiAgICB9XG5cbiAgICAvLyBJZiBhIHRpbWVyIGlzIGFscmVhZHkgcnVubmluZywgY2FwdHVyZSB0aGUgZWxhcHNlZCB0aW1lIGFuZCBjbGVhciBpdC5cbiAgICBpZiAoZWxlbS50aW1lcikge1xuICAgICAgZWxhcHNlZCA9IE1hdGguYWJzKGVsZW0udGltZXIuc3RhcnRlZCAtIG5ldyBEYXRlKCkpXG4gICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KGVsZW0udGltZXIuY2xvY2spXG4gICAgfVxuXG4gICAgLy8gU3RhcnQgYSBuZXcgdGltZXIuXG4gICAgZWxlbS50aW1lciA9IHsgc3RhcnRlZDogbmV3IERhdGUoKSB9XG4gICAgZWxlbS50aW1lci5jbG9jayA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIFRoZSB0aW1lciBjb21wbGV0ZWQsIHNvIGxldOKAmXMgZmlyZSB0aGUgY2FsbGJhY2sgYW5kIG51bGwgdGhlIHRpbWVyLlxuICAgICAgZWxlbS5jb25maWdbY2FsbGJhY2tdKGVsZW0uZG9tRWwpXG4gICAgICBlbGVtLnRpbWVyID0gbnVsbFxuICAgIH0sIGR1cmF0aW9uIC0gZWxhcHNlZClcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zaG91bGRSZXZlYWwgKGVsZW0pIHtcbiAgICBpZiAoZWxlbS5zZXF1ZW5jZSkge1xuICAgICAgdmFyIHNlcXVlbmNlID0gc3Iuc2VxdWVuY2VzW2VsZW0uc2VxdWVuY2UuaWRdXG4gICAgICByZXR1cm4gc2VxdWVuY2UuYWN0aXZlICYmXG4gICAgICAgICFzZXF1ZW5jZS5ibG9ja2VkICYmXG4gICAgICAgICFlbGVtLnJldmVhbGluZyAmJlxuICAgICAgICAhZWxlbS5kaXNhYmxlZFxuICAgIH1cbiAgICByZXR1cm4gX2lzRWxlbVZpc2libGUoZWxlbSkgJiZcbiAgICAgICFlbGVtLnJldmVhbGluZyAmJlxuICAgICAgIWVsZW0uZGlzYWJsZWRcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zaG91bGRVc2VEZWxheSAoZWxlbSkge1xuICAgIHZhciBjb25maWcgPSBlbGVtLmNvbmZpZy51c2VEZWxheVxuICAgIHJldHVybiBjb25maWcgPT09ICdhbHdheXMnIHx8XG4gICAgICAoY29uZmlnID09PSAnb25sb2FkJyAmJiAhc3IuaW5pdGlhbGl6ZWQpIHx8XG4gICAgICAoY29uZmlnID09PSAnb25jZScgJiYgIWVsZW0uc2VlbilcbiAgfVxuXG4gIGZ1bmN0aW9uIF9zaG91bGRSZXNldCAoZWxlbSkge1xuICAgIGlmIChlbGVtLnNlcXVlbmNlKSB7XG4gICAgICB2YXIgc2VxdWVuY2UgPSBzci5zZXF1ZW5jZXNbZWxlbS5zZXF1ZW5jZS5pZF1cbiAgICAgIHJldHVybiAhc2VxdWVuY2UuYWN0aXZlICYmXG4gICAgICAgIGVsZW0uY29uZmlnLnJlc2V0ICYmXG4gICAgICAgIGVsZW0ucmV2ZWFsaW5nICYmXG4gICAgICAgICFlbGVtLmRpc2FibGVkXG4gICAgfVxuICAgIHJldHVybiAhX2lzRWxlbVZpc2libGUoZWxlbSkgJiZcbiAgICAgIGVsZW0uY29uZmlnLnJlc2V0ICYmXG4gICAgICBlbGVtLnJldmVhbGluZyAmJlxuICAgICAgIWVsZW0uZGlzYWJsZWRcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRDb250YWluZXIgKGNvbnRhaW5lcikge1xuICAgIHJldHVybiB7XG4gICAgICB3aWR0aDogY29udGFpbmVyLmNsaWVudFdpZHRoLFxuICAgICAgaGVpZ2h0OiBjb250YWluZXIuY2xpZW50SGVpZ2h0XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2dldFNjcm9sbGVkIChjb250YWluZXIpIHtcbiAgICAvLyBSZXR1cm4gdGhlIGNvbnRhaW5lciBzY3JvbGwgdmFsdWVzLCBwbHVzIHRoZSBpdHMgb2Zmc2V0LlxuICAgIGlmIChjb250YWluZXIgJiYgY29udGFpbmVyICE9PSB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgICB2YXIgb2Zmc2V0ID0gX2dldE9mZnNldChjb250YWluZXIpXG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiBjb250YWluZXIuc2Nyb2xsTGVmdCArIG9mZnNldC5sZWZ0LFxuICAgICAgICB5OiBjb250YWluZXIuc2Nyb2xsVG9wICsgb2Zmc2V0LnRvcFxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBPdGhlcndpc2UsIGRlZmF1bHQgdG8gdGhlIHdpbmRvdyBvYmplY3TigJlzIHNjcm9sbCB2YWx1ZXMuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiB3aW5kb3cucGFnZVhPZmZzZXQsXG4gICAgICAgIHk6IHdpbmRvdy5wYWdlWU9mZnNldFxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRPZmZzZXQgKGRvbUVsKSB7XG4gICAgdmFyIG9mZnNldFRvcCA9IDBcbiAgICB2YXIgb2Zmc2V0TGVmdCA9IDBcblxuICAgICAgLy8gR3JhYiB0aGUgZWxlbWVudOKAmXMgZGltZW5zaW9ucy5cbiAgICB2YXIgb2Zmc2V0SGVpZ2h0ID0gZG9tRWwub2Zmc2V0SGVpZ2h0XG4gICAgdmFyIG9mZnNldFdpZHRoID0gZG9tRWwub2Zmc2V0V2lkdGhcblxuICAgIC8vIE5vdyBjYWxjdWxhdGUgdGhlIGRpc3RhbmNlIGJldHdlZW4gdGhlIGVsZW1lbnQgYW5kIGl0cyBwYXJlbnQsIHRoZW5cbiAgICAvLyBhZ2FpbiBmb3IgdGhlIHBhcmVudCB0byBpdHMgcGFyZW50LCBhbmQgYWdhaW4gZXRjLi4uIHVudGlsIHdlIGhhdmUgdGhlXG4gICAgLy8gdG90YWwgZGlzdGFuY2Ugb2YgdGhlIGVsZW1lbnQgdG8gdGhlIGRvY3VtZW504oCZcyB0b3AgYW5kIGxlZnQgb3JpZ2luLlxuICAgIGRvIHtcbiAgICAgIGlmICghaXNOYU4oZG9tRWwub2Zmc2V0VG9wKSkge1xuICAgICAgICBvZmZzZXRUb3AgKz0gZG9tRWwub2Zmc2V0VG9wXG4gICAgICB9XG4gICAgICBpZiAoIWlzTmFOKGRvbUVsLm9mZnNldExlZnQpKSB7XG4gICAgICAgIG9mZnNldExlZnQgKz0gZG9tRWwub2Zmc2V0TGVmdFxuICAgICAgfVxuICAgICAgZG9tRWwgPSBkb21FbC5vZmZzZXRQYXJlbnRcbiAgICB9IHdoaWxlIChkb21FbClcblxuICAgIHJldHVybiB7XG4gICAgICB0b3A6IG9mZnNldFRvcCxcbiAgICAgIGxlZnQ6IG9mZnNldExlZnQsXG4gICAgICBoZWlnaHQ6IG9mZnNldEhlaWdodCxcbiAgICAgIHdpZHRoOiBvZmZzZXRXaWR0aFxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIF9pc0VsZW1WaXNpYmxlIChlbGVtKSB7XG4gICAgdmFyIG9mZnNldCA9IF9nZXRPZmZzZXQoZWxlbS5kb21FbClcbiAgICB2YXIgY29udGFpbmVyID0gX2dldENvbnRhaW5lcihlbGVtLmNvbmZpZy5jb250YWluZXIpXG4gICAgdmFyIHNjcm9sbGVkID0gX2dldFNjcm9sbGVkKGVsZW0uY29uZmlnLmNvbnRhaW5lcilcbiAgICB2YXIgdkYgPSBlbGVtLmNvbmZpZy52aWV3RmFjdG9yXG5cbiAgICAgIC8vIERlZmluZSB0aGUgZWxlbWVudCBnZW9tZXRyeS5cbiAgICB2YXIgZWxlbUhlaWdodCA9IG9mZnNldC5oZWlnaHRcbiAgICB2YXIgZWxlbVdpZHRoID0gb2Zmc2V0LndpZHRoXG4gICAgdmFyIGVsZW1Ub3AgPSBvZmZzZXQudG9wXG4gICAgdmFyIGVsZW1MZWZ0ID0gb2Zmc2V0LmxlZnRcbiAgICB2YXIgZWxlbUJvdHRvbSA9IGVsZW1Ub3AgKyBlbGVtSGVpZ2h0XG4gICAgdmFyIGVsZW1SaWdodCA9IGVsZW1MZWZ0ICsgZWxlbVdpZHRoXG5cbiAgICByZXR1cm4gY29uZmlybUJvdW5kcygpIHx8IGlzUG9zaXRpb25GaXhlZCgpXG5cbiAgICBmdW5jdGlvbiBjb25maXJtQm91bmRzICgpIHtcbiAgICAgIC8vIERlZmluZSB0aGUgZWxlbWVudOKAmXMgZnVuY3Rpb25hbCBib3VuZGFyaWVzIHVzaW5nIGl0cyB2aWV3IGZhY3Rvci5cbiAgICAgIHZhciB0b3AgPSBlbGVtVG9wICsgZWxlbUhlaWdodCAqIHZGXG4gICAgICB2YXIgbGVmdCA9IGVsZW1MZWZ0ICsgZWxlbVdpZHRoICogdkZcbiAgICAgIHZhciBib3R0b20gPSBlbGVtQm90dG9tIC0gZWxlbUhlaWdodCAqIHZGXG4gICAgICB2YXIgcmlnaHQgPSBlbGVtUmlnaHQgLSBlbGVtV2lkdGggKiB2RlxuXG4gICAgICAvLyBEZWZpbmUgdGhlIGNvbnRhaW5lciBmdW5jdGlvbmFsIGJvdW5kYXJpZXMgdXNpbmcgaXRzIHZpZXcgb2Zmc2V0LlxuICAgICAgdmFyIHZpZXdUb3AgPSBzY3JvbGxlZC55ICsgZWxlbS5jb25maWcudmlld09mZnNldC50b3BcbiAgICAgIHZhciB2aWV3TGVmdCA9IHNjcm9sbGVkLnggKyBlbGVtLmNvbmZpZy52aWV3T2Zmc2V0LmxlZnRcbiAgICAgIHZhciB2aWV3Qm90dG9tID0gc2Nyb2xsZWQueSAtIGVsZW0uY29uZmlnLnZpZXdPZmZzZXQuYm90dG9tICsgY29udGFpbmVyLmhlaWdodFxuICAgICAgdmFyIHZpZXdSaWdodCA9IHNjcm9sbGVkLnggLSBlbGVtLmNvbmZpZy52aWV3T2Zmc2V0LnJpZ2h0ICsgY29udGFpbmVyLndpZHRoXG5cbiAgICAgIHJldHVybiB0b3AgPCB2aWV3Qm90dG9tICYmXG4gICAgICAgIGJvdHRvbSA+IHZpZXdUb3AgJiZcbiAgICAgICAgbGVmdCA8IHZpZXdSaWdodCAmJlxuICAgICAgICByaWdodCA+IHZpZXdMZWZ0XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNQb3NpdGlvbkZpeGVkICgpIHtcbiAgICAgIHJldHVybiAod2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbS5kb21FbCkucG9zaXRpb24gPT09ICdmaXhlZCcpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFV0aWxpdGllc1xuICAgKiAtLS0tLS0tLS1cbiAgICovXG5cbiAgZnVuY3Rpb24gVG9vbHMgKCkge31cblxuICBUb29scy5wcm90b3R5cGUuaXNPYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgcmV0dXJuIG9iamVjdCAhPT0gbnVsbCAmJiB0eXBlb2Ygb2JqZWN0ID09PSAnb2JqZWN0JyAmJiBvYmplY3QuY29uc3RydWN0b3IgPT09IE9iamVjdFxuICB9XG5cbiAgVG9vbHMucHJvdG90eXBlLmlzTm9kZSA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gdHlwZW9mIHdpbmRvdy5Ob2RlID09PSAnb2JqZWN0J1xuICAgICAgPyBvYmplY3QgaW5zdGFuY2VvZiB3aW5kb3cuTm9kZVxuICAgICAgOiBvYmplY3QgJiYgdHlwZW9mIG9iamVjdCA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgdHlwZW9mIG9iamVjdC5ub2RlVHlwZSA9PT0gJ251bWJlcicgJiZcbiAgICAgICAgdHlwZW9mIG9iamVjdC5ub2RlTmFtZSA9PT0gJ3N0cmluZydcbiAgfVxuXG4gIFRvb2xzLnByb3RvdHlwZS5pc05vZGVMaXN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHZhciBwcm90b3R5cGVUb1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmplY3QpXG4gICAgdmFyIHJlZ2V4ID0gL15cXFtvYmplY3QgKEhUTUxDb2xsZWN0aW9ufE5vZGVMaXN0fE9iamVjdClcXF0kL1xuXG4gICAgcmV0dXJuIHR5cGVvZiB3aW5kb3cuTm9kZUxpc3QgPT09ICdvYmplY3QnXG4gICAgICA/IG9iamVjdCBpbnN0YW5jZW9mIHdpbmRvdy5Ob2RlTGlzdFxuICAgICAgOiBvYmplY3QgJiYgdHlwZW9mIG9iamVjdCA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgcmVnZXgudGVzdChwcm90b3R5cGVUb1N0cmluZykgJiZcbiAgICAgICAgdHlwZW9mIG9iamVjdC5sZW5ndGggPT09ICdudW1iZXInICYmXG4gICAgICAgIChvYmplY3QubGVuZ3RoID09PSAwIHx8IHRoaXMuaXNOb2RlKG9iamVjdFswXSkpXG4gIH1cblxuICBUb29scy5wcm90b3R5cGUuZm9yT3duID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICBpZiAoIXRoaXMuaXNPYmplY3Qob2JqZWN0KSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRXhwZWN0ZWQgXCJvYmplY3RcIiwgYnV0IHJlY2VpdmVkIFwiJyArIHR5cGVvZiBvYmplY3QgKyAnXCIuJylcbiAgICB9IGVsc2Uge1xuICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gb2JqZWN0KSB7XG4gICAgICAgIGlmIChvYmplY3QuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XG4gICAgICAgICAgY2FsbGJhY2socHJvcGVydHkpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBUb29scy5wcm90b3R5cGUuZXh0ZW5kID0gZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7XG4gICAgdGhpcy5mb3JPd24oc291cmNlLCBmdW5jdGlvbiAocHJvcGVydHkpIHtcbiAgICAgIGlmICh0aGlzLmlzT2JqZWN0KHNvdXJjZVtwcm9wZXJ0eV0pKSB7XG4gICAgICAgIGlmICghdGFyZ2V0W3Byb3BlcnR5XSB8fCAhdGhpcy5pc09iamVjdCh0YXJnZXRbcHJvcGVydHldKSkge1xuICAgICAgICAgIHRhcmdldFtwcm9wZXJ0eV0gPSB7fVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZXh0ZW5kKHRhcmdldFtwcm9wZXJ0eV0sIHNvdXJjZVtwcm9wZXJ0eV0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0YXJnZXRbcHJvcGVydHldID0gc291cmNlW3Byb3BlcnR5XVxuICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSlcbiAgICByZXR1cm4gdGFyZ2V0XG4gIH1cblxuICBUb29scy5wcm90b3R5cGUuZXh0ZW5kQ2xvbmUgPSBmdW5jdGlvbiAodGFyZ2V0LCBzb3VyY2UpIHtcbiAgICByZXR1cm4gdGhpcy5leHRlbmQodGhpcy5leHRlbmQoe30sIHRhcmdldCksIHNvdXJjZSlcbiAgfVxuXG4gIFRvb2xzLnByb3RvdHlwZS5pc01vYmlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxCbGFja0JlcnJ5fElFTW9iaWxlfE9wZXJhIE1pbmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpXG4gIH1cblxuICAvKipcbiAgICogUG9seWZpbGxzXG4gICAqIC0tLS0tLS0tXG4gICAqL1xuXG4gIF9yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGNhbGxiYWNrLCAxMDAwIC8gNjApXG4gICAgfVxuXG4gIC8qKlxuICAgKiBNb2R1bGUgV3JhcHBlclxuICAgKiAtLS0tLS0tLS0tLS0tLVxuICAgKi9cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGRlZmluZS5hbWQgPT09ICdvYmplY3QnICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFNjcm9sbFJldmVhbFxuICAgIH0pXG4gIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IFNjcm9sbFJldmVhbFxuICB9IGVsc2Uge1xuICAgIHdpbmRvdy5TY3JvbGxSZXZlYWwgPSBTY3JvbGxSZXZlYWxcbiAgfVxufSkoKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbm9kZV9tb2R1bGVzL3Njcm9sbHJldmVhbC9kaXN0L3Njcm9sbHJldmVhbC5qc1xuLy8gbW9kdWxlIGlkID0gLi9ub2RlX21vZHVsZXMvc2Nyb2xscmV2ZWFsL2Rpc3Qvc2Nyb2xscmV2ZWFsLmpzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCAxIiwiaW1wb3J0IHNjcm9sbCBmcm9tICcuLi9zY3JpcHRzL3Njcm9sbCc7XG5pbXBvcnQgbmF2T25Nb2JpbGUgZnJvbSAnLi4vc2NyaXB0cy9uYXZPbk1vYmlsZSc7XG5cbmltcG9ydCAnLi4vc3R5bGVzL3VzZXJmZWVkcy5zY3NzJztcblxuaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgaW5pdCgpO1xufSBlbHNlIHtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBpbml0KTtcbn1cblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgc2Nyb2xsKCk7XG4gIG5hdk9uTW9iaWxlKCk7XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvYWJvdXQvYWJvdXQuanMiLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBpbml0TmF2T25Nb2JpbGUoKSB7XG4gIHZhciAkYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLW1vYmlsZU1lbnUnKTtcblxuICAkYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIHZhciB0YXJnZXQgPSAkYnV0dG9uLmdldEF0dHJpYnV0ZSgnZGF0YS10YXJnZXQnKTtcblxuICAgIGlmICh0YXJnZXQgIT0gdW5kZWZpbmVkICYmIHRhcmdldCAhPSAnJykge1xuICAgICAgJGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldCkuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XG4gICAgfVxuICB9KTtcbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9zY3JpcHRzL25hdk9uTW9iaWxlLmpzIiwiaW1wb3J0IFNjcm9sbFJldmVhbCBmcm9tICdzY3JvbGxyZXZlYWwnO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBpbml0U2Nyb2xsUmV2ZWFsKCkge1xuICB3aW5kb3cuc3IgPSBTY3JvbGxSZXZlYWwoeyBkdXJhdGlvbjogNzAwLCB2aWV3RmFjdG9yOiAwLjQgfSk7XG5cbiAgaWYgKHNyLmlzU3VwcG9ydGVkKCkpe1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzcicpO1xuXG4gICAgc3IucmV2ZWFsKCcuYW5pbS1mYWRlJywgeyBkaXN0YW5jZTogJzBweCcsIHNjYWxlOiAxLCBkdXJhdGlvbjogMTAwMDAgfSk7XG4gICAgc3IucmV2ZWFsKCcuYW5pbS1mYWRlQm90dG9tJywge29yaWdpbjogXCJib3R0b21cIiwgc2NhbGU6MSwgZGlzdGFuY2U6JzEwcHgnLCBlYXNpbmc6ICdlYXNlLWluJywgZHVyYXRpb246MzAwfSk7XG4gICAgc3IucmV2ZWFsKCcuYW5pbS1mYWRlUmlnaHQnLCB7IG9yaWdpbjogXCJyaWdodFwiIH0pO1xuICAgIHNyLnJldmVhbCgnLmFuaW0tZmFkZUxlZnQnLCB7IG9yaWdpbjogXCJsZWZ0XCIgLCBzY2FsZTogMSwgZGlzdGFuY2U6JzIwcHgnLCBlYXNpbmc6ICdjdWJpYy1iZXppZXIoMC42LCAwLjMsIDAuMSwgMSknIH0pO1xuICAgIHNyLnJldmVhbCgnLmFuaW0tZmFkZVRvcCcsIHsgb3JpZ2luOiBcInRvcFwiIH0pO1xuICAgIHNyLnJldmVhbCgnLmFuaW0tYmFja1RvRnJvbnQnLCB7IHNjYWxlOiAwLjUgfSk7XG4gICAgc3IucmV2ZWFsKCcuYW5pbS1mcm9udFRvQmFjaycsIHsgc2NhbGU6IDEuMiB9KTtcbiAgfSBlbHNlIHtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc3InKTtcbiAgfVxufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL3NjcmlwdHMvc2Nyb2xsLmpzIl0sInNvdXJjZVJvb3QiOiIifQ==